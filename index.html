﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿﻿<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>24小时负荷曲线生成工具</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 使用系统默认字体 -->
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        code, pre {
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        }
    </style>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script>
        // Chart.js 加载失败时的备用方案
        if (typeof Chart === 'undefined') {
            console.warn('Chart.js CDN加载失败，尝试加载本地备用...');
            document.write('<script src="js/lib/chart.umd.js"><\/script>');
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // XLSX 加载失败时的备用方案
        if (typeof XLSX === 'undefined') {
            console.warn('XLSX CDN加载失败，尝试加载本地备用...');
            document.write('<script src="js/lib/xlsx.full.min.js"><\/script>');
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script>
        // JSZip 加载失败时的备用方案
        if (typeof JSZip === 'undefined') {
            console.warn('JSZip CDN加载失败，尝试加载本地备用...');
            document.write('<script src="js/lib/jszip.min.js"><\/script>');
        }
    </script>
    <script src="js/config.js"></script>
    <style type="text/tailwindcss">
        /* ==================== 现代化企业级样式系统 ==================== */
        
        @layer base {
            html {
                @apply scroll-smooth m-0 p-0;
                scrollbar-gutter: stable;
                overflow-y: scroll;
                margin-top: 0 !important;
                padding-top: 0 !important;
            }
            body {
                @apply text-slate-800 antialiased overflow-x-hidden min-h-screen m-0 p-0;
                background-color: #f8fafc;
                background-image: 
                    radial-gradient(at 0% 0%, rgba(59, 130, 246, 0.12) 0px, transparent 50%),
                    radial-gradient(at 100% 0%, rgba(139, 92, 246, 0.08) 0px, transparent 50%),
                    radial-gradient(at 100% 100%, rgba(236, 72, 153, 0.05) 0px, transparent 50%),
                    radial-gradient(at 0% 100%, rgba(6, 182, 212, 0.08) 0px, transparent 50%);
                background-attachment: fixed;
                font-feature-settings: "cv02", "cv05", "cv08", "cv09", "cv11";
                margin-top: 0 !important;
                padding-top: 0 !important;
            }
        }

        @layer utilities {
            /* 性能优化工具类 */
            .content-auto {
                content-visibility: auto;
                contain-intrinsic-size: 0 500px;
            }
            
            .gpu-accelerated {
                transform: translateZ(0);
                will-change: transform;
            }
            
            /* 滚动条样式优化 */
            .scrollbar-hide {
                scrollbar-width: none;
                -ms-overflow-style: none;
            }
            .scrollbar-hide::-webkit-scrollbar {
                display: none;
            }
            
            .scrollbar-thin {
                scrollbar-width: thin;
                scrollbar-color: #cbd5e1 #f1f5f9;
            }
            .scrollbar-thin::-webkit-scrollbar {
                width: 6px;
                height: 6px;
            }
            .scrollbar-thin::-webkit-scrollbar-track {
                background: #f1f5f9;
                border-radius: 3px;
            }
            .scrollbar-thin::-webkit-scrollbar-thumb {
                background: #cbd5e1;
                border-radius: 3px;
            }
            .scrollbar-thin::-webkit-scrollbar-thumb:hover {
                background: #94a3b8;
            }
            
            /* 现代化阴影系统 */
            .shadow-soft {
                box-shadow: 0 2px 15px -3px rgba(0, 0, 0, 0.07), 0 10px 20px -2px rgba(0, 0, 0, 0.04);
            }
            
            /* 修复圆角容器在部分浏览器下的裁剪残影（直角边）问题 */
            .overflow-hidden[class*="rounded-"] {
                mask-image: radial-gradient(white, black);
                -webkit-mask-image: -webkit-radial-gradient(white, black);
                /* 强制开启 GPU 加速并优化层叠上下文渲染 */
                backface-visibility: hidden;
                -webkit-backface-visibility: hidden;
                transform: translateZ(0);
                /* 消除边缘锯齿和可能的直角背景色泄露 */
                background-clip: padding-box;
            }
            
            .shadow-medium {
                box-shadow: 0 4px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            }
            
            .shadow-strong {
                box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.15), 0 2px 10px -2px rgba(0, 0, 0, 0.05);
            }
            
            /* 动画系统 */
            @keyframes scaleIn {
                from { opacity: 0; transform: scale(0.95) translateY(10px); }
                to { opacity: 1; transform: scale(1) translateY(0); }
            }
            
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }
            
            .animate-scale-in {
                animation: scaleIn 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            }
            
            .animate-fade-in {
                animation: fadeIn 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            }
            
            .animate-shake {
                animation: shake 0.4s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
            }

            /* 无障碍：尊重用户减少动画的偏好 */
            @media (prefers-reduced-motion: reduce) {
                .animate-scale-in,
                .animate-fade-in,
                .animate-shake {
                    animation: none;
                    opacity: 1;
                    transform: none;
                }

                .transition-smooth,
                .transition-fast,
                .transition-all-300,
                .hover-lift {
                    transition: none;
                }
            }

            /* 渐变背景 - 分析仪表板配色 */
            .bg-gradient-primary {
                background: linear-gradient(135deg, #4f46e5 0%, #3730a3 100%);
            }
            
            .bg-gradient-secondary {
                background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            }
            
            .bg-gradient-accent {
                background: linear-gradient(135deg, #818cf8 0%, #6366f1 100%);
            }
            
            .bg-gradient-surface {
                background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            }
            
            /* 动画系统 */
            .transition-smooth {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            
            .transition-fast {
                transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            }

            .transition-all-300 {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            
            /* 悬停效果 */
            .hover-lift {
                transition: transform 0.2s ease, box-shadow 0.2s ease;
            }
            .hover-lift:hover {
                transform: translateY(-2px);
                @apply shadow-medium;
            }
            
            /* 玻璃态效果 */
            .glass {
                @apply bg-white/70 backdrop-blur-md border border-white/30 shadow-sm;
            }
            
            .glass-frosted {
                @apply bg-white/60 backdrop-blur-xl border border-white/40 shadow-md;
            }

            .glass-dark {
                @apply bg-slate-900/40 backdrop-blur-xl border border-white/10;
            }

            /* 现代化按钮基础样式 */
            .btn-base {
                @apply px-6 py-2.5 rounded-xl text-sm font-semibold transition-all duration-300 flex items-center justify-center gap-2 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed shadow-sm;
            }

            .btn-primary {
                @apply btn-base bg-gradient-to-r from-indigo-700 to-indigo-800 text-white shadow-indigo-200 hover:shadow-indigo-300/60 hover:-translate-y-0.5;
            }

            .btn-violet {
                @apply btn-base bg-gradient-to-br from-indigo-600 to-indigo-700 text-white shadow-indigo-100 hover:shadow-indigo-200/60 hover:-translate-y-0.5;
            }

            .btn-rose {
                @apply btn-base bg-gradient-to-br from-indigo-500 to-indigo-600 text-white shadow-indigo-100 hover:shadow-indigo-200/60 hover:-translate-y-0.5;
            }

            .btn-summary {
                @apply btn-base bg-gradient-to-br from-indigo-600 to-indigo-700 text-white shadow-indigo-100 hover:shadow-indigo-200/60 hover:-translate-y-0.5;
            }

            .btn-secondary {
                @apply btn-base bg-white text-slate-700 border border-slate-200 hover:bg-slate-50 hover:border-slate-300/70 hover:shadow-md hover:-translate-y-0.5;
            }

            .btn-success {
                @apply btn-base bg-gradient-to-br from-indigo-500 to-indigo-600 text-white shadow-indigo-100 hover:shadow-indigo-200/60 hover:-translate-y-0.5;
            }

            .btn-danger {
                @apply btn-base bg-gradient-to-br from-slate-500 to-slate-600 text-white shadow-slate-100 hover:shadow-slate-200/60 hover:-translate-y-0.5;
            }

            /* 现代化卡片基础样式 */
            .card-base {
                @apply bg-white rounded-2xl border border-slate-200 shadow-sm transition-smooth;
            }

            .card-hover {
                @apply card-base hover:shadow-medium hover:border-slate-300/60;
            }
        }

        @layer components {
            /* Dashboard 基础布局组件 */
            .sidebar-link {
                @apply flex items-center px-4 py-3 text-sm font-medium rounded-xl transition-all duration-200 hover:bg-slate-800 hover:text-white;
            }
            .sidebar-link.active {
                @apply bg-indigo-700 text-white shadow-lg shadow-indigo-900/20;
            }
            
            /* Dashboard 侧边栏样式 */
            .sidebar-container {
                @apply fixed top-0 left-0 h-full w-64 glass-dark text-slate-300 z-50 transition-transform duration-300 ease-in-out border-r border-white/10 shadow-lg;
            }
            
            /* 主内容区域样式 */
            .main-content {
                @apply min-h-screen transition-all duration-300 ease-in-out md:pl-64 bg-transparent;
            }
            
            /* 顶部状态栏样式 - 极致悬浮方案：压缩间距，使其与下方卡片更协调 */
            .top-bar {
                @apply sticky top-0 z-30 px-6 pt-4 pb-2 md:px-8 lg:px-10 xl:px-14 flex flex-col md:flex-row md:items-center justify-between gap-4 mb-0;
                background: transparent;
                border-bottom: none;
                box-shadow: none;
                top: 0 !important;
            }
            
            /* 卡片组件 */
            .dashboard-card {
                @apply glass rounded-3xl shadow-soft transition-all duration-300 hover:shadow-medium hover:border-white/50 relative overflow-hidden;
            }
            
            /* 按钮组件 */
            .btn-dashboard-primary {
                @apply btn-base rounded-xl glass text-slate-700 hover:bg-white/90 hover:shadow-md;
            }
            
            /* 统计数值卡片 */
            .stat-card {
                @apply p-6 dashboard-card flex items-start justify-between;
            }
            
            .stat-icon {
                @apply w-12 h-12 rounded-xl flex items-center justify-center text-xl glass shadow-inner;
            }
        }
        
        /* ==================== 现代化图表容器样式 ==================== */
        
        #chartContainer, #barChartContainer {
            position: relative;
            @apply glass;
            border-radius: 1rem;
            padding: 1.5rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        #chartContainer:hover, #barChartContainer:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.15);
        }
        
        #chartContainer.loading {
            animation: pulseSoft 2s ease-in-out infinite;
        }
        
        #chartContainer canvas, #barChartContainer canvas {
            width: 100% !important;
            height: 100% !important;
            border-radius: 0.5rem;
        }
        
        /* 图表加载状态 */
        .chart-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 1rem;
            border: 2px dashed #cbd5e1;
        }
        
        .chart-loading::before {
            content: '';
            width: 40px;
            height: 40px;
            border: 4px solid #e2e8f0;
            border-top: 4px solid #1e40af;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes spinSlow {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .animate-spin-slow {
            animation: spinSlow 2.4s linear infinite;
        }

        /* 返回顶部按钮 - 分析仪表板配色 */
        #backToTop {
            position: fixed;
            right: 2rem;
            bottom: 2rem;
            z-index: 9999;
            display: flex;
            height: 3rem;
            width: 3rem;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: linear-gradient(135deg, #4f46e5 0%, #6366f1 100%);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            color: white;
            box-shadow: 0 4px 20px rgba(30, 64, 175, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.2) inset;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
            visibility: hidden;
            border: none;
            cursor: pointer;
            transform: translateY(20px);
        }
        #backToTop:hover {
            background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%);
            transform: translateY(-4px) scale(1.1);
            box-shadow: 0 8px 30px rgba(30, 64, 175, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.3) inset;
        }
        #backToTop:active {
            transform: translateY(-2px) scale(0.95);
        }
        #backToTop.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        #backToTop i {
            font-size: 1rem;
            transition: transform 0.3s ease;
        }
        #backToTop:hover i {
            transform: translateY(-2px);
        }
        /* 进度环效果 */
        #backToTop::before {
            content: '';
            position: absolute;
            inset: -3px;
            border-radius: 50%;
            background: conic-gradient(from 0deg, transparent 0%, rgba(30, 64, 175, 0.3) var(--scroll-progress, 0%), transparent var(--scroll-progress, 0%));
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        #backToTop.show::before {
            opacity: 1;
        }
        
        /* 布局优化 */
        .dashboard-section {
            margin-bottom: 2rem;
        }

        @media (prefers-reduced-motion: reduce) {
            .animate-spin-slow {
                animation: none;
            }
        }
        
        /* ==================== 全新数据预览样式 ==================== */
        
        #dataPreview {
            border-radius: 1rem;
            overflow: hidden;
            @apply glass;
        }
        
        #dataPreview .preview-header {
            padding: 1.25rem 1.5rem;
            background: transparent;
            border-bottom: 1px solid rgba(241, 245, 249, 0.5);
        }
        
        #dataPreview .preview-header-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        #dataPreview .preview-header-icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.625rem;
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.875rem;
        }
        
        #dataPreview .preview-header-text h3 {
            font-size: 0.9375rem;
            font-weight: 600;
            color: #0f172a;
            line-height: 1.25;
        }
        
        #dataPreview .preview-header-text p {
            font-size: 0.75rem;
            color: #64748b;
            margin-top: 0.125rem;
        }
        
        #dataPreview .preview-stats {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        #dataPreview .preview-stat-item {
            flex: 1;
            padding: 0.875rem 1rem;
            background: rgba(248, 250, 252, 0.4);
            border-radius: 0.625rem;
            border: 1px solid rgba(241, 245, 249, 0.5);
        }
        
        #dataPreview .preview-stat-label {
            font-size: 0.6875rem;
            font-weight: 500;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }
        
        #dataPreview .preview-stat-value {
            font-size: 1.125rem;
            font-weight: 600;
            color: #0f172a;
            margin-top: 0.25rem;
        }
        
        #dataPreview .preview-stat-value span {
            font-size: 0.75rem;
            font-weight: 500;
            color: #94a3b8;
            margin-left: 0.25rem;
        }
        
        #dataPreview .preview-status {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.375rem 0.75rem;
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 9999px;
        }
        
        #dataPreview .preview-status-dot {
            width: 0.375rem;
            height: 0.375rem;
            border-radius: 9999px;
            background: #22c55e;
        }
        
        #dataPreview .preview-status-text {
            font-size: 0.6875rem;
            font-weight: 500;
            color: #15803d;
        }
        
        #dataPreview .preview-table-container {
            overflow-x: auto;
            background: transparent;
        }
        
        #dataPreview .preview-table {
            display: grid;
            min-width: fit-content;
        }
        
        #dataPreview .preview-table-header {
            display: contents;
        }
        
        #dataPreview .preview-table-header > div {
            position: sticky;
            top: 0;
            z-index: 10;
            padding: 0.75rem 0.625rem;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.6875rem;
            font-weight: 600;
            color: #475569;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }
        
        #dataPreview .preview-table-header > div:first-child {
            position: sticky;
            left: 0;
            z-index: 20;
            background: #f1f5f9;
            text-align: left;
            padding-left: 1rem;
        }
        
        #dataPreview .preview-table-body {
            display: contents;
        }
        
        #dataPreview .preview-table-row {
            display: contents;
        }
        
        #dataPreview .preview-table-row > div {
            padding: 0.625rem;
            border-bottom: 1px solid #f1f5f9;
            font-size: 0.8125rem;
            color: #334155;
            text-align: center;
            background: #ffffff;
        }
        
        #dataPreview .preview-table-row > div:first-child {
            position: sticky;
            left: 0;
            z-index: 5;
            background: #ffffff;
            text-align: left;
            padding-left: 1rem;
            font-weight: 500;
            color: #0f172a;
            border-right: 1px solid #f1f5f9;
        }
        
        #dataPreview .preview-table-row:nth-child(even) > div {
            background: #fafafa;
        }
        
        #dataPreview .preview-table-row:nth-child(even) > div:first-child {
            background: #f8fafc;
        }
        
        #dataPreview .preview-table-row:hover > div {
            background: #f0f9ff;
        }
        
        #dataPreview .preview-table-row:hover > div:first-child {
            background: #e0f2fe;
        }
        
        #dataPreview .preview-table-total {
            font-weight: 600;
            color: #4f46e5;
        }
        
        #dataPreview .preview-notice {
            padding: 0.625rem 1rem;
            background: #f8fafc;
            border-top: 1px solid #f1f5f9;
            font-size: 0.75rem;
            color: #64748b;
        }
        
        /* 响应式优化 */
        @media (max-width: 1024px) {
            #dataPreview .preview-header {
                padding: 1rem;
            }
            
            #dataPreview .preview-stats {
                gap: 0.75rem;
            }
            
            #dataPreview .preview-stat-item {
                padding: 0.75rem;
            }
            
            #dataPreview .preview-stat-value {
                font-size: 1rem;
            }
        }
        
        @media (max-width: 768px) {
            #dataPreview {
                border-radius: 0.75rem;
            }
            
            #dataPreview .preview-header-icon {
                width: 2.25rem;
                height: 2.25rem;
                font-size: 0.75rem;
            }
            
            #dataPreview .preview-header-text h3 {
                font-size: 0.875rem;
            }
            
            #dataPreview .preview-stats {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            #dataPreview .preview-table-header > div,
            #dataPreview .preview-table-row > div {
                padding: 0.5rem 0.375rem;
                font-size: 0.75rem;
            }
        }
        
        /* ==================== 可折叠面板样式 ==================== */
        

        
        /* ==================== 文字居中样式 ==================== */
        
        /**
         * 文字居中样式
         * 使用flexbox实现水平和垂直居中
         */
        .text-center-div {
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* ==================== 表头冻结样式 ==================== */
        
        /**
         * 表头冻结样式
         * 在滚动时保持表头可见
         */
        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 10;
            background-color: white;
            border-bottom: 1px solid #e5e7eb;
        }
        
        /* ==================== 卡片标题栏样式 ==================== */
        
        /**
         * 卡片标题栏样式
         * 提供统一的卡片标题外观和交互效果
         */
        .card-header {
            background-color: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
            padding: 12px 20px;
            font-weight: 600;
            font-size: 16px;
            color: #374151;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        /**
         * 卡片标题栏悬停效果
         */
        .card-header:hover {
            background-color: #f3f4f6;
        }
        
        /**
         * 卡片内容样式
         */
        .card-content {
            padding: 20px;
        }
        
        /* ==================== 下拉箭头动画 ==================== */
        

        
        /* ==================== 响应式居中样式 ==================== */
        
        /**
         * 响应式居中
         * 在小屏幕设备上调整文字居中方式
         */
        @media (max-width: 768px) {
            .text-center-div {
                text-align: center;
                display: block;
            }
        }
        
        /* ==================== 现代化卡片组件样式 ==================== */
        
        .card {
            background: linear-gradient(135deg, #ffffff 0%, #fafbfc 100%);
            border-radius: 1rem;
            box-shadow: 0 4px 25px -5px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(226, 232, 240, 0.8);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(79, 70, 229, 0.3), transparent);
            opacity: 0;
            transition: opacity 0.4s ease;
        }
        
        .card:hover {
                box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(79, 70, 229, 0.1);
                transform: translateY(-4px) scale(1.01);
                border-color: rgba(79, 70, 229, 0.2);
            }
        
        .card:hover::before {
            opacity: 1;
        }
        
        .card-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 0.75rem;
            background: linear-gradient(135deg, #1e293b 0%, #475569 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .card-content {
            color: #64748b;
            line-height: 1.7;
            font-size: 0.95rem;
        }
        
        /* 特殊卡片变体 */
        .card-glass {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .card-elevated {
            box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.15);
        }
        
        /* ==================== 现代化按钮组件样式 ==================== */
        
        /* 按钮尺寸变体 */
        .btn-sm {
            @apply px-4 py-1.5 text-xs rounded-lg;
        }
        
        .btn-lg {
            @apply px-8 py-3 text-base rounded-2xl;
        }
        
        /* 按钮禁用状态 */
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

</style>
</head>
<!-- 
    ==================== HTML文档主体 ====================
    负荷曲线生成工具的主界面，包含访问验证、导航栏和主要内容区域
-->
<body class="font-sans text-slate-800">
    <!-- 
        ==================== 作者信息弹窗 ====================
        进入网页时显示的作者信息和欢迎提示
    -->
    <div id="authorInfoModal" class="fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 overflow-y-auto py-10">
        <div class="bg-white rounded-3xl p-0 max-w-lg w-full mx-4 shadow-2xl animate-scale-in overflow-hidden border border-slate-200">
            <div class="p-8">
                <div class="text-center">
                    <div class="w-24 h-24 rounded-2xl bg-gradient-to-br from-indigo-500 to-indigo-700 flex items-center justify-center mx-auto mb-6 shadow-lg shadow-indigo-200 hover:rotate-0 transition-transform duration-300">
                        <i class="fa fa-user-tie text-white text-4xl"></i>
                    </div>
                    <h2 class="text-3xl font-black text-slate-800 mb-2 tracking-tight">负荷曲线分析工具</h2>
                    <p class="text-slate-500 font-medium mb-8">专业电力数据可视化解决方案</p>
                    
                    <!-- 作者信息区域 -->
                    <div id="authorSection" class="space-y-6 animate-fade-in">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="col-span-2 bg-indigo-50 rounded-2xl p-4 border border-indigo-100 flex items-center gap-4 group/author">
                                <div class="w-12 h-12 rounded-full bg-white shadow-sm flex items-center justify-center text-indigo-600 group-hover/author:scale-110 transition-transform duration-300">
                                    <i class="fa fa-user-tie text-xl"></i>
                                </div>
                                <div class="text-left">
                                    <p class="text-xs text-indigo-400 font-bold uppercase tracking-wider">核心作者</p>
                                    <p class="text-lg font-black text-slate-800">冯伟明</p>
                                </div>
                            </div>
                            
                            <div class="bg-slate-50 rounded-2xl p-4 border border-slate-100 text-left hover:border-indigo-200 transition-all duration-300 hover:shadow-md hover:shadow-indigo-50 group/item">
                                <p class="text-xs text-slate-400 font-bold uppercase mb-1 flex items-center gap-1">
                                    <i class="fab fa-weixin text-indigo-500"></i> 微信联系
                                </p>
                                <p class="text-sm font-bold text-slate-700 break-all group-hover/item:text-indigo-600 transition-colors">Call13345934750</p>
                            </div>
                            
                            <div class="bg-slate-50 rounded-2xl p-4 border border-slate-100 text-left hover:border-indigo-200 transition-all duration-300 hover:shadow-md hover:shadow-indigo-50 group/item">
                                <p class="text-xs text-slate-400 font-bold uppercase mb-1 flex items-center gap-1">
                                    <i class="fa fa-comments text-indigo-500"></i> 公众号
                                </p>
                                <p class="text-sm font-bold text-slate-700 group-hover/item:text-indigo-600 transition-colors">能源小鲨鱼</p>
                            </div>
                        </div>
                        
                        <div class="bg-slate-50 rounded-2xl p-5 border border-slate-100 text-left relative overflow-hidden group">
                            <div class="absolute -right-4 -top-4 w-20 h-20 bg-indigo-200/20 rounded-full blur-2xl group-hover:bg-indigo-300/30 transition-colors"></div>
                            <h4 class="text-sm font-bold text-slate-900 mb-3 flex items-center gap-2">
                                <i class="fa fa-lightbulb text-indigo-500"></i>
                                使用指南
                            </h4>
                            <ul class="text-xs text-slate-600 space-y-2.5 font-medium">
                                <li class="flex items-start gap-2">
                                    <span class="w-1.5 h-1.5 rounded-full bg-indigo-400 mt-1 flex-shrink-0"></span>
                                    支持 Excel (.xlsx/.xls) 智能导入
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="w-1.5 h-1.5 rounded-full bg-indigo-400 mt-1 flex-shrink-0"></span>
                                    秒级生成 24H 负荷趋势与分布图表
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="w-1.5 h-1.5 rounded-full bg-indigo-400 mt-1 flex-shrink-0"></span>
                                    一键导出专业分析报告与原始数据
                                </li>
                            </ul>
                        </div>
                        
                        <button id="startUsingBtn" 
                                class="w-full bg-gradient-to-r from-indigo-600 to-indigo-700 text-white py-3 rounded-xl hover:shadow-lg hover:shadow-indigo-200 hover:-translate-y-0.5 active:translate-y-0 transition-all duration-200 font-bold text-lg flex items-center justify-center gap-3">
                            <i class="fa fa-rocket"></i>
                            开启专业分析之旅
                        </button>
                        
                        <div class="pt-2 flex items-center justify-center gap-4 text-slate-400 text-xs font-bold uppercase tracking-[0.2em]">
                            <span>Version 1.0.0</span>
                            <span class="w-1 h-1 rounded-full bg-slate-300"></span>
                            <span>Professional Edition</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 
        ==================== 顶部导航栏 (已废弃 - 改为左侧Sidebar) ====================
    -->
    <!-- Header removed -->

    <!-- 
        ==================== 使用说明面板 ====================
        现代化Dashboard风格模态框
    -->
    <div id="helpPanel" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[100] hidden items-center justify-center transition-opacity duration-300">
        <div class="bg-white rounded-2xl shadow-2xl border border-slate-100 w-full max-w-4xl mx-4 md:mx-auto max-h-[90vh] flex flex-col transform transition-all duration-300 scale-95 opacity-0" id="helpModalContent">
            <!-- 标题栏 -->
            <div class="px-6 py-5 border-b border-slate-100 rounded-t-2xl flex justify-between items-center bg-slate-50/50 flex-shrink-0">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600">
                        <i class="fa fa-book text-lg"></i>
                    </div>
                    <h2 class="text-xl font-extrabold text-slate-900 tracking-tight">📚 使用指南</h2>
                </div>
                <button id="closeHelpBtn" class="flex h-9 w-9 items-center justify-center rounded-full text-slate-400 hover:bg-slate-200 hover:text-slate-700 transition-all" aria-label="关闭帮助" title="关闭帮助">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="p-6 md:p-8 overflow-y-auto custom-scrollbar space-y-8">
                <!-- 快速开始指南 -->
                <div class="bg-indigo-50/50 border border-indigo-100 rounded-2xl p-6 relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-5">
                        <i class="fa fa-rocket text-7xl text-indigo-600"></i>
                    </div>
                    <h3 class="text-lg font-bold text-indigo-900 mb-4 flex items-center gap-2">
                        <i class="fa fa-bolt text-indigo-500"></i> 快速开始
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="bg-white/60 p-4 rounded-xl border border-indigo-100/50">
                            <div class="text-indigo-600 font-black text-xl mb-1">01</div>
                            <div class="text-sm font-bold text-slate-800">数据导入</div>
                            <div class="text-xs text-slate-500 mt-1">上传您的Excel负荷文件</div>
                        </div>
                        <div class="bg-white/60 p-4 rounded-xl border border-indigo-100/50">
                            <div class="text-indigo-600 font-black text-xl mb-1">02</div>
                            <div class="text-sm font-bold text-slate-800">参数配置</div>
                            <div class="text-xs text-slate-500 mt-1">对齐日期与数值范围</div>
                        </div>
                        <div class="bg-white/60 p-4 rounded-xl border border-indigo-100/50">
                            <div class="text-indigo-600 font-black text-xl mb-1">03</div>
                            <div class="text-sm font-bold text-slate-800">分析预览</div>
                            <div class="text-xs text-slate-500 mt-1">实时查看负荷趋势曲线</div>
                        </div>
                        <div class="bg-white/60 p-4 rounded-xl border border-indigo-100/50">
                            <div class="text-indigo-600 font-black text-xl mb-1">04</div>
                            <div class="text-sm font-bold text-slate-800">导出报告</div>
                            <div class="text-xs text-slate-500 mt-1">下载专业分析Excel结果</div>
                        </div>
                    </div>
                </div>

                <!-- 功能说明 -->
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="group border border-slate-200 rounded-2xl p-6 hover:border-indigo-200 hover:shadow-md transition-all">
                        <h4 class="font-bold text-slate-900 mb-4 flex items-center gap-2">
                            <i class="fa fa-chart-line text-indigo-500"></i> 核心分析功能
                        </h4>
                        <ul class="space-y-3 text-sm text-slate-600">
                            <li class="flex items-center gap-3">
                                <span class="w-1.5 h-1.5 rounded-full bg-indigo-400"></span>
                                24小时精细负荷曲线
                            </li>
                            <li class="flex items-center gap-3">
                                <span class="w-1.5 h-1.5 rounded-full bg-indigo-400"></span>
                                每日总量柱状对比
                            </li>
                            <li class="flex items-center gap-3">
                                <span class="w-1.5 h-1.5 rounded-full bg-indigo-400"></span>
                                数据异常点自动识别与填充
                            </li>
                            <li class="flex items-center gap-3">
                                <span class="w-1.5 h-1.5 rounded-full bg-indigo-400"></span>
                                响应式交互数据点查询
                            </li>
                        </ul>
                    </div>
                    <div class="group border border-slate-200 rounded-2xl p-6 hover:border-indigo-200 hover:shadow-md transition-all">
                        <h4 class="font-bold text-slate-900 mb-4 flex items-center gap-2">
                            <i class="fa fa-sliders-h text-indigo-500"></i> 灵活配置选项
                        </h4>
                        <ul class="space-y-3 text-sm text-slate-600">
                            <li class="flex items-center gap-3">
                                <span class="w-1.5 h-1.5 rounded-full bg-indigo-400"></span>
                                多种数据结构(Wide/Long)适配
                            </li>
                            <li class="flex items-center gap-3">
                                <span class="w-1.5 h-1.5 rounded-full bg-indigo-400"></span>
                                自定义计算倍率与颗粒度
                            </li>
                            <li class="flex items-center gap-3">
                                <span class="w-1.5 h-1.5 rounded-full bg-indigo-400"></span>
                                高级过滤器与计量点选择
                            </li>
                            <li class="flex items-center gap-3">
                                <span class="w-1.5 h-1.5 rounded-full bg-indigo-400"></span>
                                图表样式与辅助Y轴切换
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- 常见问题 -->
                <div class="space-y-4">
                    <h3 class="text-lg font-bold text-slate-900 flex items-center gap-2">
                        <i class="fa fa-question-circle text-indigo-500"></i> 常见问题
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-slate-50 border border-slate-100 p-4 rounded-xl">
                            <h4 class="font-bold text-slate-800 text-sm mb-2">Q: 无法识别日期格式？</h4>
                            <p class="text-xs text-slate-500 leading-relaxed">A: 请确保Excel中的日期列格式规范，或者在【数据配置】中手动指定日期索引列。</p>
                        </div>
                        <div class="bg-slate-50 border border-slate-100 p-4 rounded-xl">
                            <h4 class="font-bold text-slate-800 text-sm mb-2">Q: 如何处理异常数据点？</h4>
                            <p class="text-xs text-slate-500 leading-relaxed">A: 在处理引擎设置中选择【智能邻域填充】，系统将自动修复零值或突跳点。</p>
                        </div>
                    </div>
                </div>

                <!-- 版本信息 -->
                <div class="bg-slate-900 rounded-2xl p-6 text-slate-300 relative overflow-hidden">
                    <div class="absolute bottom-0 right-0 p-4 opacity-10">
                        <i class="fa fa-info-circle text-8xl"></i>
                    </div>
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 relative z-10">
                        <div>
                            <div class="text-xs font-bold text-indigo-400 uppercase tracking-widest mb-1">System Status</div>
                            <div class="text-xl font-black text-white">Version 1.0.0 Stable</div>
                        </div>
                        <div class="space-y-1 text-sm">
                            <p><span class="text-slate-500">作者：</span>冯伟明</p>
                            <p><span class="text-slate-500">微信：</span>Call13345934750</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--
        ==================== 多页报告预览模态框 ====================
        专业的4页负荷分析报告预览
    -->
    <div id="reportPreviewPanel" class="fixed inset-0 bg-slate-900/70 backdrop-blur-sm z-[200] hidden items-center justify-center transition-opacity duration-300">
        <div class="bg-white rounded-2xl shadow-2xl border border-slate-200 w-full max-w-5xl mx-4 md:mx-auto max-h-[95vh] flex flex-col transform transition-all duration-300 scale-95 opacity-0" id="reportPreviewContent">
            <!-- 标题栏 -->
            <div class="px-6 py-4 border-b border-slate-200 rounded-t-2xl flex justify-between items-center bg-gradient-to-r from-indigo-600 to-indigo-800 flex-shrink-0">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-white/20 flex items-center justify-center text-white backdrop-blur-sm">
                        <i class="fa fa-file-alt text-lg"></i>
                    </div>
                    <div>
                        <h2 class="text-xl font-black text-white tracking-tight">负荷数据分析报告</h2>
                        <p class="text-indigo-100 text-xs mt-0.5">专业版 · 4页详细分析</p>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <span class="px-3 py-1 rounded-full bg-white/20 text-white text-xs font-medium backdrop-blur-sm" id="reportPageIndicator">第 1 / 4 页</span>
                    <button id="closeReportPreviewBtn" class="flex h-9 w-9 items-center justify-center rounded-xl text-white/80 hover:bg-white/20 hover:text-white transition-all" aria-label="关闭报告预览">
                        <i class="fa fa-times text-xl"></i>
                    </button>
                </div>
            </div>

            <!-- 报告内容区域 -->
            <div class="flex-1 overflow-hidden bg-slate-100 relative">
                <!-- 第1页：概览与关键指标 -->
                <div id="reportPage1" class="report-page absolute inset-0 overflow-y-auto p-8">
                    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg min-h-[800px] p-10">
                        <!-- 报告封面 -->
                        <div class="text-center mb-10 pb-8 border-b-2 border-indigo-100">
                            <div class="w-20 h-20 rounded-2xl bg-gradient-to-br from-indigo-500 to-indigo-700 flex items-center justify-center mx-auto mb-6 shadow-lg">
                                <i class="fa fa-bolt text-4xl text-white"></i>
                            </div>
                            <h1 class="text-3xl font-black text-slate-900 mb-3">电力负荷数据分析报告</h1>
                            <p class="text-slate-500 text-lg">Load Data Analysis Report</p>
                            <div class="mt-6 inline-flex items-center gap-2 px-4 py-2 bg-slate-100 rounded-full text-sm text-slate-600">
                                <i class="far fa-calendar-alt"></i>
                                <span id="reportDateRange">--</span>
                            </div>
                        </div>

                        <!-- 关键指标卡片 -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-10">
                            <div class="bg-gradient-to-br from-indigo-50 to-indigo-100/50 rounded-xl p-5 border border-indigo-100">
                                <div class="text-xs font-bold text-indigo-600 uppercase tracking-wider mb-2">总用电量</div>
                                <div class="text-2xl font-black text-slate-900" id="reportTotalEnergy">--</div>
                                <div class="text-xs text-indigo-500/70 mt-1">kWh</div>
                            </div>
                            <div class="bg-gradient-to-br from-slate-50 to-slate-100/50 rounded-xl p-5 border border-slate-100">
                                <div class="text-xs font-bold text-slate-600 uppercase tracking-wider mb-2">平均负荷</div>
                                <div class="text-2xl font-black text-slate-900" id="reportAvgLoad">--</div>
                                <div class="text-xs text-slate-500/70 mt-1">kW</div>
                            </div>
                            <div class="bg-gradient-to-br from-indigo-50 to-indigo-100/50 rounded-xl p-5 border border-indigo-100">
                                <div class="text-xs font-bold text-indigo-600 uppercase tracking-wider mb-2">最大负荷</div>
                                <div class="text-2xl font-black text-slate-900" id="reportMaxLoad">--</div>
                                <div class="text-xs text-indigo-500/70 mt-1">kW</div>
                            </div>
                            <div class="bg-gradient-to-br from-slate-50 to-slate-100/50 rounded-xl p-5 border border-slate-100">
                                <div class="text-xs font-bold text-slate-600 uppercase tracking-wider mb-2">最小负荷</div>
                                <div class="text-2xl font-black text-slate-900" id="reportMinLoad">--</div>
                                <div class="text-xs text-slate-500/70 mt-1">kW</div>
                            </div>
                        </div>

                        <!-- 数据摘要 -->
                        <div class="bg-slate-50 rounded-xl p-6 mb-8">
                            <h3 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2">
                                <i class="fa fa-chart-pie text-indigo-500"></i> 数据摘要
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center py-2 border-b border-slate-200">
                                        <span class="text-slate-600">数据天数</span>
                                        <span class="font-bold text-slate-900" id="reportTotalDays">-- 天</span>
                                    </div>
                                    <div class="flex justify-between items-center py-2 border-b border-slate-200">
                                        <span class="text-slate-600">数据点数</span>
                                        <span class="font-bold text-slate-900" id="reportTotalPoints">-- 个</span>
                                    </div>
                                    <div class="flex justify-between items-center py-2 border-b border-slate-200">
                                        <span class="text-slate-600">负荷率</span>
                                        <span class="font-bold text-slate-900" id="reportLoadFactor">-- %</span>
                                    </div>
                                </div>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center py-2 border-b border-slate-200">
                                        <span class="text-slate-600">峰值出现时间</span>
                                        <span class="font-bold text-slate-900" id="reportPeakTime">--</span>
                                    </div>
                                    <div class="flex justify-between items-center py-2 border-b border-slate-200">
                                        <span class="text-slate-600">谷值出现时间</span>
                                        <span class="font-bold text-slate-900" id="reportValleyTime">--</span>
                                    </div>
                                    <div class="flex justify-between items-center py-2 border-b border-slate-200">
                                        <span class="text-slate-600">峰谷差</span>
                                        <span class="font-bold text-slate-900" id="reportPeakValleyDiff">-- kW</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 分析结论 -->
                        <div class="bg-indigo-50 rounded-xl p-6 border border-indigo-100">
                            <h3 class="text-lg font-bold text-indigo-900 mb-3 flex items-center gap-2">
                                <i class="fa fa-lightbulb text-indigo-500"></i> 初步分析结论
                            </h3>
                            <p class="text-slate-700 leading-relaxed" id="reportConclusion">
                                根据数据分析，该负荷曲线呈现典型的工作日用电模式。建议在低谷时段（22:00-06:00）安排大功率设备运行，以降低用电成本。
                            </p>
                        </div>
                    </div>
                </div>

                <!-- 第2页：负荷曲线分析 -->
                <div id="reportPage2" class="report-page absolute inset-0 overflow-y-auto p-8 hidden">
                    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg min-h-[800px] p-10">
                        <div class="flex items-center gap-3 mb-8 pb-4 border-b-2 border-indigo-100">
                            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-indigo-500 to-indigo-700 flex items-center justify-center text-white shadow-md">
                                <i class="fa fa-chart-line text-xl"></i>
                            </div>
                            <div>
                                <h2 class="text-2xl font-black text-slate-900">负荷曲线分析</h2>
                                <p class="text-slate-500 text-sm">Load Curve Analysis</p>
                            </div>
                        </div>

                        <!-- 曲线图区域 -->
                        <div class="mb-8">
                            <div class="bg-slate-50 rounded-xl p-4 border border-slate-200">
                                <img id="reportChartImage" class="w-full rounded-lg" alt="负荷曲线图" src="">
                                <p class="text-center text-xs text-slate-400 mt-3">图1：24小时负荷曲线对比图</p>
                            </div>
                        </div>

                        <!-- 曲线特征分析 -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                            <div class="bg-slate-50 rounded-xl p-6">
                                <h3 class="text-base font-bold text-slate-900 mb-4 flex items-center gap-2">
                                    <i class="fa fa-sun text-indigo-500"></i> 日间负荷特征 (06:00-18:00)
                                </h3>
                                <ul class="space-y-2 text-sm text-slate-700">
                                    <li class="flex items-start gap-2">
                                        <span class="w-1.5 h-1.5 rounded-full bg-indigo-500 mt-2"></span>
                                        <span>日间平均负荷：<strong id="reportDayAvg">-- kW</strong></span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <span class="w-1.5 h-1.5 rounded-full bg-indigo-500 mt-2"></span>
                                        <span>日间用电量占比：<strong id="reportDayRatio">-- %</strong></span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <span class="w-1.5 h-1.5 rounded-full bg-indigo-500 mt-2"></span>
                                        <span>峰值出现时段：<strong id="reportDayPeakTime">--</strong></span>
                                    </li>
                                </ul>
                            </div>
                            <div class="bg-slate-50 rounded-xl p-6">
                                <h3 class="text-base font-bold text-slate-900 mb-4 flex items-center gap-2">
                                    <i class="fa fa-moon text-indigo-500"></i> 夜间负荷特征 (18:00-06:00)
                                </h3>
                                <ul class="space-y-2 text-sm text-slate-700">
                                    <li class="flex items-start gap-2">
                                         <span class="w-1.5 h-1.5 rounded-full bg-indigo-500 mt-2"></span>
                                         <span>夜间平均负荷：<strong id="reportNightAvg">-- kW</strong></span>
                                     </li>
                                    <li class="flex items-start gap-2">
                                        <span class="w-1.5 h-1.5 rounded-full bg-indigo-500 mt-2"></span>
                                        <span>夜间用电量占比：<strong id="reportNightRatio">-- %</strong></span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <span class="w-1.5 h-1.5 rounded-full bg-indigo-500 mt-2"></span>
                                        <span>谷值出现时段：<strong id="reportNightValleyTime">--</strong></span>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <!-- 季节性分析 -->
                        <div class="bg-gradient-to-r from-indigo-50/80 to-slate-50 rounded-xl p-6 border border-indigo-100">
                            <h3 class="text-base font-bold text-slate-900 mb-4 flex items-center gap-2">
                                <i class="fa fa-calendar-alt text-indigo-500"></i> 季节性负荷变化
                            </h3>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div class="bg-white rounded-lg p-4 text-center shadow-sm">
                                    <div class="text-xs text-slate-500 mb-1">春季 (Q1)</div>
                                    <div class="text-lg font-bold text-slate-900" id="reportQ1Avg">-- kW</div>
                                </div>
                                <div class="bg-white rounded-lg p-4 text-center shadow-sm">
                                    <div class="text-xs text-slate-500 mb-1">夏季 (Q2)</div>
                                    <div class="text-lg font-bold text-slate-900" id="reportQ2Avg">-- kW</div>
                                </div>
                                <div class="bg-white rounded-lg p-4 text-center shadow-sm">
                                    <div class="text-xs text-slate-500 mb-1">秋季 (Q3)</div>
                                    <div class="text-lg font-bold text-slate-900" id="reportQ3Avg">-- kW</div>
                                </div>
                                <div class="bg-white rounded-lg p-4 text-center shadow-sm">
                                    <div class="text-xs text-slate-500 mb-1">冬季 (Q4)</div>
                                    <div class="text-lg font-bold text-slate-900" id="reportQ4Avg">-- kW</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 第3页：时段分析与建议 -->
                <div id="reportPage3" class="report-page absolute inset-0 overflow-y-auto p-8 hidden">
                    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg min-h-[800px] p-10">
                        <div class="flex items-center gap-3 mb-8 pb-4 border-b-2 border-indigo-100">
                            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-indigo-500 to-indigo-600 flex items-center justify-center text-white shadow-md">
                                <i class="fa fa-lightbulb text-xl"></i>
                            </div>
                            <div>
                                <h2 class="text-2xl font-black text-slate-900">时段分析与优化建议</h2>
                                <p class="text-slate-500 text-sm">Time-of-Use Analysis & Recommendations</p>
                            </div>
                        </div>

                        <!-- 时段分布表 -->
                        <div class="mb-8">
                            <h3 class="text-lg font-bold text-slate-900 mb-4">各时段用电分布</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm">
                                    <thead>
                                        <tr class="bg-slate-100">
                                            <th class="px-4 py-3 text-left font-bold text-slate-700 rounded-tl-lg">时段</th>
                                            <th class="px-4 py-3 text-center font-bold text-slate-700">时间范围</th>
                                            <th class="px-4 py-3 text-right font-bold text-slate-700">平均负荷</th>
                                            <th class="px-4 py-3 text-right font-bold text-slate-700">用电量占比</th>
                                            <th class="px-4 py-3 text-center font-bold text-slate-700 rounded-tr-lg">负荷等级</th>
                                        </tr>
                                    </thead>
                                    <tbody id="reportTimeTable" class="divide-y divide-slate-200">
                                        <!-- 动态生成 -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- 优化建议 -->
                        <div class="space-y-6">
                            <h3 class="text-lg font-bold text-slate-900 flex items-center gap-2">
                                <i class="fa fa-tasks text-indigo-500"></i> 优化建议
                            </h3>

                            <div class="bg-indigo-50 rounded-xl p-6 border border-indigo-100">
                                <div class="flex items-start gap-4">
                                    <div class="w-10 h-10 rounded-lg bg-indigo-500 flex items-center justify-center text-white flex-shrink-0">
                                        <i class="fa fa-clock"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-indigo-900 mb-2">错峰用电建议</h4>
                                        <p class="text-slate-700 text-sm leading-relaxed" id="reportSuggestion1">
                                            建议在低谷时段（22:00-06:00）安排大功率设备运行，可降低约15-20%的用电成本。
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-slate-50 rounded-xl p-6 border border-slate-100">
                                <div class="flex items-start gap-4">
                                    <div class="w-10 h-10 rounded-lg bg-slate-500 flex items-center justify-center text-white flex-shrink-0">
                                        <i class="fa fa-battery-three-quarters"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-slate-900 mb-2">负荷平衡建议</h4>
                                        <p class="text-slate-700 text-sm leading-relaxed" id="reportSuggestion2">
                                            当前峰谷差较大，建议通过储能设备或调整生产计划来平衡负荷，提高设备利用率。
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-slate-50 rounded-xl p-6 border border-slate-100">
                                <div class="flex items-start gap-4">
                                    <div class="w-10 h-10 rounded-lg bg-slate-500 flex items-center justify-center text-white flex-shrink-0">
                                        <i class="fa fa-solar-panel"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-slate-900 mb-2">新能源配置建议</h4>
                                        <p class="text-slate-700 text-sm leading-relaxed" id="reportSuggestion3">
                                            根据日间用电特征，建议配置光伏发电系统，可有效降低日间电网用电量。
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 第4页：详细数据表格 -->
                <div id="reportPage4" class="report-page absolute inset-0 overflow-y-auto p-8 hidden">
                    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg min-h-[800px] p-10">
                        <div class="flex items-center gap-3 mb-8 pb-4 border-b-2 border-slate-200">
                            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-slate-600 to-slate-800 flex items-center justify-center text-white shadow-md">
                                <i class="fa fa-table text-xl"></i>
                            </div>
                            <div>
                                <h2 class="text-2xl font-black text-slate-900">详细数据汇总</h2>
                                <p class="text-slate-500 text-sm">Detailed Data Summary</p>
                            </div>
                        </div>

                        <!-- 月度汇总表 -->
                        <div class="mb-8">
                            <h3 class="text-lg font-bold text-slate-900 mb-4">月度用电汇总</h3>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm">
                                    <thead>
                                        <tr class="bg-slate-100">
                                            <th class="px-4 py-3 text-left font-bold text-slate-700 rounded-tl-lg">月份</th>
                                            <th class="px-4 py-3 text-right font-bold text-slate-700">总用电量(kWh)</th>
                                            <th class="px-4 py-3 text-right font-bold text-slate-700">平均负荷(kW)</th>
                                            <th class="px-4 py-3 text-right font-bold text-slate-700">最大负荷(kW)</th>
                                            <th class="px-4 py-3 text-right font-bold text-slate-700">最小负荷(kW)</th>
                                            <th class="px-4 py-3 text-right font-bold text-slate-700 rounded-tr-lg">负荷率(%)</th>
                                        </tr>
                                    </thead>
                                    <tbody id="reportMonthlyTable" class="divide-y divide-slate-200">
                                        <!-- 动态生成 -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- 极值统计 -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                            <div class="bg-gradient-to-br from-indigo-50 to-slate-50 rounded-xl p-6 border border-indigo-100">
                                <h4 class="font-bold text-indigo-900 mb-4 flex items-center gap-2">
                                    <i class="fa fa-arrow-up text-indigo-500"></i> 用电高峰日 TOP 5
                                </h4>
                                <table class="w-full text-sm">
                                    <thead>
                                        <tr class="border-b border-indigo-200">
                                            <th class="text-left py-2 text-indigo-700">日期</th>
                                            <th class="text-right py-2 text-indigo-700">用电量(kWh)</th>
                                        </tr>
                                    </thead>
                                    <tbody id="reportTopPeakDays">
                                        <!-- 动态生成 -->
                                    </tbody>
                                </table>
                            </div>
                            <div class="bg-gradient-to-br from-indigo-50 to-slate-50 rounded-xl p-6 border border-indigo-100">
                                <h4 class="font-bold text-indigo-900 mb-4 flex items-center gap-2">
                                    <i class="fa fa-arrow-down text-indigo-500"></i> 用电低谷日 TOP 5
                                </h4>
                                <table class="w-full text-sm">
                                    <thead>
                                        <tr class="border-b border-indigo-200">
                                            <th class="text-left py-2 text-indigo-700">日期</th>
                                            <th class="text-right py-2 text-indigo-700">用电量(kWh)</th>
                                        </tr>
                                    </thead>
                                    <tbody id="reportTopValleyDays">
                                        <!-- 动态生成 -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- 报告底部 -->
                        <div class="mt-10 pt-6 border-t border-slate-200 text-center">
                            <p class="text-xs text-slate-400">
                                本报告由负荷数据处理系统自动生成 · 仅供参考
                            </p>
                            <p class="text-xs text-slate-400 mt-1">
                                生成时间：<span id="reportGenerateTime">--</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 底部导航栏 -->
            <div class="px-6 py-4 border-t border-slate-200 bg-white flex justify-between items-center flex-shrink-0">
                <button id="reportPrevBtn" class="flex items-center gap-2 px-5 py-2.5 rounded-lg bg-slate-100 text-slate-700 font-medium hover:bg-slate-200 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fa fa-chevron-left"></i>
                    <span>上一页</span>
                </button>

                <div class="flex items-center gap-2">
                    <button class="report-dot w-3 h-3 rounded-full bg-indigo-600 transition-all" data-page="1"></button>
                    <button class="report-dot w-3 h-3 rounded-full bg-slate-300 transition-all" data-page="2"></button>
                    <button class="report-dot w-3 h-3 rounded-full bg-slate-300 transition-all" data-page="3"></button>
                    <button class="report-dot w-3 h-3 rounded-full bg-slate-300 transition-all" data-page="4"></button>
                </div>

                <div class="flex items-center gap-3">
                    <button id="reportDownloadBtn" class="flex items-center gap-2 px-5 py-2.5 rounded-lg bg-indigo-600 text-white font-medium hover:bg-indigo-700 transition-all shadow-md shadow-indigo-100">
                        <i class="fa fa-download"></i>
                        <span>导出PDF</span>
                    </button>
                    <button id="reportNextBtn" class="flex items-center gap-2 px-5 py-2.5 rounded-lg bg-indigo-600 text-white font-medium hover:bg-indigo-700 transition-all">
                        <span>下一页</span>
                        <i class="fa fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!--
        ==================== 主内容区域 ====================
        包含工具的主要功能区域，使用响应式布局确保在不同设备上的良好显示
        主要包括：步骤指示器、文件导入、数据配置、可视化和导出结果等功能模块
    -->
    <!--
        ==================== 左侧悬浮导航栏 ====================
        现代化的悬浮导航设计，支持收纳/展开功能
        固定在页面左侧，提供主要功能导航
    -->
    <!-- 
        ==================== 左侧侧边栏导航 (New Sidebar) ====================
        替代原有的悬浮导航，提供固定左侧的现代化导航体验
    -->
    <!-- Layout Wrapper -->
    <div class="flex min-h-screen overflow-x-hidden pt-0">
        <!-- Left Sidebar -->
        <aside id="sidebar" class="fixed top-0 left-0 w-[260px] h-screen bg-slate-900 text-slate-300 transition-transform duration-300 ease-in-out z-50 flex flex-col shadow-xl -translate-x-full md:translate-x-0">
            <!-- Brand -->
            <div class="h-16 flex items-center px-6 border-b border-slate-800 bg-slate-900/50 shrink-0">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-lg bg-indigo-600 flex items-center justify-center shadow-lg shadow-indigo-900/50">
                        <i class="fa fa-chart-line text-white text-sm"></i>
                    </div>
                    <span class="text-lg font-bold text-white tracking-wide">EnergyLens</span>
                </div>
            </div>
        
            <!-- Navigation -->
            <nav class="flex-1 overflow-y-auto py-6 px-3 space-y-1 custom-scrollbar">
                <!-- Section Label -->
                <div class="px-3 mb-2 text-xs font-semibold text-slate-500 uppercase tracking-wider">主要功能</div>
                
                <!-- Nav Items -->
                <a href="javascript:void(0)" onclick="scrollToSection('importSection')" class="sidebar-link active flex items-center px-4 py-3 text-sm font-medium rounded-xl transition-all duration-200 hover:bg-slate-800 hover:text-white group gap-3" data-section="importSection">
                    <i class="fas fa-cloud-upload-alt w-5 text-center"></i>
                    <span>数据导入</span>
                </a>
                
                <a href="javascript:void(0)" onclick="scrollToSection('configSection')" class="sidebar-link flex items-center px-4 py-3 text-sm font-medium rounded-xl transition-all duration-200 hover:bg-slate-800 hover:text-white group gap-3" data-section="configSection">
                    <i class="fas fa-sliders-h w-5 text-center"></i>
                    <span>数据配置</span>
                </a>
                
                <a href="javascript:void(0)" onclick="scrollToSection('visualizationSection')" class="sidebar-link flex items-center px-4 py-3 text-sm font-medium rounded-xl transition-all duration-200 hover:bg-slate-800 hover:text-white group gap-3" data-section="visualizationSection">
                    <i class="fas fa-chart-area w-5 text-center"></i>
                    <span>负荷分析</span>
                </a>
                
                <a href="javascript:void(0)" onclick="scrollToSection('exportSection')" class="sidebar-link flex items-center px-4 py-3 text-sm font-medium rounded-xl transition-all duration-200 hover:bg-slate-800 hover:text-white group gap-3" data-section="exportSection">
                    <i class="fas fa-file-export w-5 text-center"></i>
                    <span>导出报告</span>
                </a>

                <div class="px-3 mt-8 mb-2 text-xs font-semibold text-slate-500 uppercase tracking-wider">系统设置</div>
                
                <a href="javascript:void(0)" id="helpBtn" class="sidebar-link flex items-center px-4 py-3 text-sm font-medium rounded-xl transition-all duration-200 hover:bg-slate-800 hover:text-white group gap-3">
                    <i class="fas fa-question-circle w-5 text-center"></i>
                    <span>使用指南</span>
                </a>
            </nav>

            <!-- Sidebar Footer -->
            <div class="border-t border-slate-800 p-4 bg-slate-900/50">
                <div class="flex items-center gap-3 px-2">
                    <div class="w-8 h-8 rounded-full bg-indigo-900/50 border border-indigo-700/50 flex items-center justify-center text-indigo-400">
                        <i class="fa fa-user text-xs"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-bold text-white truncate">管理员</p>
                        <p class="text-xs text-slate-500 truncate">能源分析系统 v1.0</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <div class="flex-1 min-w-0 flex flex-col md:ml-[260px]">
            <!-- Mobile Sidebar Overlay -->
            <div id="sidebarOverlay" class="fixed inset-0 bg-slate-900/50 z-40 hidden backdrop-blur-sm transition-opacity opacity-0" aria-hidden="true"></div>

            <!-- Dashboard Sticky Header -->
            <div class="top-bar">
                <div class="flex items-center gap-4">
                    <button id="mobileMenuBtn" class="md:hidden text-slate-500 hover:text-indigo-600 transition-colors p-2 rounded-lg hover:bg-slate-100 border border-slate-200 bg-white">
                        <i class="fa fa-bars text-xl"></i>
                    </button>
                    <div>
                        <div class="flex flex-wrap items-center gap-3 mb-1">
                            <h2 id="currentFileName" class="text-2xl md:text-3xl font-black text-slate-800 tracking-tight">负荷数据处理</h2>
                            <div class="flex flex-wrap items-center gap-2">
                                <span class="px-2.5 py-1 rounded-full text-[10px] font-bold bg-indigo-50 text-indigo-600 border border-indigo-100 shadow-sm">实时数据</span>
                                <span class="inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-1.5 text-[10px] font-bold text-slate-600 shadow-sm">
                                    <i class="far fa-calendar-alt text-indigo-400"></i>
                                    <span id="gsMetaDateRange">--</span>
                                </span>
                                <span class="inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-1.5 text-[10px] font-bold text-slate-600 shadow-sm">
                                    <i class="far fa-clock text-indigo-400"></i>
                                    <span id="gsMetaHours">--</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <button onclick="document.getElementById('fileInput').click()" class="btn-dashboard-primary !py-1.5 !text-xs">
                        <i class="fa fa-folder-open text-indigo-500"></i>导入文件
                    </button>
                    <button onclick="scrollToSection('exportSection')" class="btn-dashboard-primary !py-1.5 !text-xs">
                        <i class="fa fa-download text-indigo-500"></i>导出报告
                    </button>
                </div>
            </div>

            <!-- Main Content Area -->
            <main class="flex-1 px-0 transition-all duration-300 overflow-x-hidden pt-0">

                <div class="px-6 md:px-8 lg:px-10 xl:px-14 pt-12">
                    <div id="globalSummary" class="mb-6">
                    <div class="grid grid-cols-2 gap-4 md:grid-cols-3 xl:grid-cols-4">
                        <div class="relative z-10 rounded-3xl border border-slate-200 bg-white p-6 shadow-soft transition-all duration-300 hover:shadow-medium hover:border-indigo-200/50 hover:-translate-y-1 transform-gpu group overflow-visible">
                            <div class="text-xs font-extrabold text-slate-500 uppercase tracking-wider mb-3 flex items-center gap-2">
                                <div class="w-1.5 h-1.5 rounded-full bg-indigo-500"></div>
                                总用电量
                            </div>
                            <div class="text-2xl font-black text-slate-900 tabular-nums flex items-baseline gap-1">
                                <span id="gsTotalEnergy">—</span>
                                <span class="text-xs font-bold text-slate-400">kWh</span>
                            </div>
                        </div>
                        <div class="relative z-10 rounded-3xl border border-slate-200 bg-white p-6 shadow-soft transition-all duration-300 hover:shadow-medium hover:border-indigo-200/50 hover:-translate-y-1 transform-gpu group overflow-visible">
                            <div class="text-xs font-extrabold text-slate-500 uppercase tracking-wider mb-3 flex items-center gap-2">
                                <div class="w-1.5 h-1.5 rounded-full bg-indigo-500"></div>
                                平均负荷
                            </div>
                            <div class="text-2xl font-black text-slate-900 tabular-nums flex items-baseline gap-1">
                                <span id="gsAvgLoad">—</span>
                                <span class="text-xs font-bold text-slate-400">kWh/h</span>
                            </div>
                        </div>
                        <div class="relative z-10 rounded-3xl border border-slate-200 bg-white p-6 shadow-soft transition-all duration-300 hover:shadow-medium hover:border-indigo-200/50 hover:-translate-y-1 transform-gpu group overflow-visible">
                            <div class="text-xs font-extrabold text-slate-500 uppercase tracking-wider mb-3 flex items-center gap-2">
                                <div class="w-1.5 h-1.5 rounded-full bg-indigo-500"></div>
                                最小负荷日
                            </div>
                            <div class="text-lg font-black text-slate-900 truncate mb-1" id="gsMinDay">—</div>
                            <div class="text-xs font-bold text-slate-400 flex items-center gap-1">
                                <span id="gsMinValue">—</span>
                                <span>kWh</span>
                            </div>
                        </div>
                        <div class="relative z-10 rounded-3xl border border-slate-200 bg-white p-6 shadow-soft transition-all duration-300 hover:shadow-medium hover:border-indigo-200/50 hover:-translate-y-1 transform-gpu group overflow-visible">
                            <div class="text-xs font-extrabold text-slate-500 uppercase tracking-wider mb-3 flex items-center gap-2">
                                <div class="w-1.5 h-1.5 rounded-full bg-indigo-500"></div>
                                最大负荷日
                            </div>
                            <div class="text-lg font-black text-slate-900 truncate mb-1" id="gsMaxDay">—</div>
                            <div class="text-xs font-bold text-slate-400 flex items-center gap-1">
                                <span id="gsMaxValue">—</span>
                                <span>kWh</span>
                            </div>
                        </div>
                    </div>
                </div>

        <!-- 导航图标样式 (已废弃) -->
        <style>
            /* 旧导航样式已移除，保留此标签防止脚本报错，但内容清空 */
        </style>

        <!-- 
            ==================== 第一部分：文件导入 ====================
            提供数据导入功能，支持Excel文件上传和预览
            使用卡片式布局，包含标题、描述和文件上传控件
        -->
        <section id="importSection" class="mb-14 section-container section-hidden">
            <div class="relative overflow-hidden rounded-3xl border border-slate-200 bg-white shadow-soft">
                <div class="relative px-6 py-6 md:px-8 md:py-8">
                    <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
                        <div class="flex items-center gap-6">
                            <div class="relative flex h-14 w-14 shrink-0 items-center justify-center rounded-2xl bg-indigo-600 text-white shadow-xl shadow-indigo-200">
                                <div class="absolute inset-0 rounded-2xl opacity-30 blur-xl bg-indigo-400"></div>
                                <i class="fa fa-cloud-upload-alt text-xl relative"></i>
                            </div>
                            <div class="pt-1">
                                <h2 class="text-2xl font-black tracking-tight text-slate-900">数据导入</h2>
                                <p class="mt-1 text-slate-500 font-medium">拖拽或选择 Excel/CSV 文件导入，系统将自动识别并生成数据概览。</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white/70 px-3 py-1.5 text-xs font-semibold text-slate-700 shadow-sm">
                                <span id="step1Indicator" class="h-2 w-2 rounded-full bg-slate-400"></span>
                                Step 1
                            </span>
                            <span id="importStatus" class="inline-flex items-center rounded-full border border-slate-200 bg-white/70 px-3 py-1.5 text-xs font-semibold text-slate-700 shadow-sm">等待文件上传</span>
                        </div>
                    </div>
                </div>

                <div class="relative mt-5 grid grid-cols-1 gap-4 px-5 pb-5 md:pl-6 md:pr-12 md:pb-6 xl:grid-cols-12 xl:items-stretch">
                    <div class="xl:col-span-8 flex flex-col h-full">
                        <div class="group relative z-10 rounded-xl border border-slate-200/80 bg-white shadow-sm hover:shadow-medium hover:-translate-y-1 transform-gpu transition-all duration-300 flex flex-col h-full overflow-visible">
                            <!-- 头部 -->
                            <div class="px-5 py-3.5 border-b border-slate-100 flex items-center justify-between shrink-0">
                                <div class="flex items-center gap-3">
                                    <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-indigo-50 text-indigo-600 shadow-sm border border-indigo-100">
                                        <i class="fa fa-cloud-upload-alt text-sm"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-[14px] font-bold text-slate-800">文件导入中心</h3>
                                        <p class="text-[11px] text-slate-400">支持 Excel / CSV 格式数据</p>
                                    </div>
                                </div>
                                <label class="flex cursor-pointer items-center gap-2 px-2.5 py-1.5 rounded-lg border border-slate-200 bg-slate-50 hover:bg-white hover:border-slate-300 transition-all">
                                    <input type="checkbox" id="appendMode" class="h-3.5 w-3.5 rounded border-slate-300 text-slate-700 focus:ring-slate-500">
                                    <span class="text-[11px] font-medium text-slate-600">启用追加模式</span>
                                </label>
                            </div>

                            <div class="p-4 flex-1 flex flex-col gap-3">
                                <div id="dropArea" class="relative flex-1 rounded-xl border-2 border-dashed border-slate-200 bg-slate-50/50 p-5 text-center transition-all duration-300 cursor-pointer group hover:border-slate-400 hover:bg-slate-100/50 focus:outline-none flex flex-col items-center justify-center" role="button" tabindex="0" aria-label="拖拽或点击上传 Excel/CSV 文件">
                                    <div class="relative z-10">
                                        <div class="mx-auto mb-3 flex h-16 w-16 items-center justify-center rounded-2xl bg-white border border-slate-200 shadow-sm transition-all duration-300 group-hover:scale-105 group-hover:shadow-md">
                                            <i class="fa fa-cloud-upload-alt text-3xl text-slate-600"></i>
                                        </div>
                                        <h4 class="text-base font-bold text-slate-700">拖拽文件到此处</h4>
                                        <p class="mt-1.5 text-[13px] text-slate-500">或 <span class="text-slate-700 font-semibold underline underline-offset-2">点击选择文件</span></p>
                                        <div class="mt-3 flex flex-wrap items-center justify-center gap-2">
                                            <span class="inline-flex items-center gap-1.5 rounded-full border border-slate-200 bg-white px-2.5 py-1 text-[11px] text-slate-500">
                                                <i class="fa fa-file-excel text-slate-500 text-[10px]"></i>
                                                Excel (.xlsx/.xls)
                                            </span>
                                            <span class="inline-flex items-center gap-1.5 rounded-full border border-slate-200 bg-white px-2.5 py-1 text-[11px] text-slate-500">
                                                <i class="fa fa-file-csv text-slate-500 text-[10px]"></i>
                                                CSV (.csv)
                                            </span>
                                        </div>
                                        <div class="mt-2 text-[10px] text-slate-400">
                                            建议单文件不超过 50MB
                                        </div>
                                        <input type="file" id="fileInput" class="hidden" accept=".xlsx,.xls,.csv" multiple="" aria-label="选择Excel或CSV文件上传">
                                    </div>
                                </div>

                                <div id="uploadProgress" class="hidden">
                                    <div class="flex items-center justify-between mb-1.5">
                                        <span class="text-[11px] font-medium text-slate-600">上传进度</span>
                                        <span id="progressText" class="text-[11px] text-slate-500">0%</span>
                                    </div>
                                    <div class="w-full bg-slate-200 rounded-full h-1.5">
                                        <div id="progressBar" class="bg-slate-700 h-1.5 rounded-full transition-all duration-300" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div class="xl:col-span-4 flex flex-col gap-4 h-full">
                        <!-- 文件列表与统计一体化容器 -->
                        <div class="group relative z-10 flex flex-col flex-1 h-full rounded-xl border border-slate-200/80 bg-white shadow-sm hover:shadow-medium hover:-translate-y-1 transform-gpu transition-all duration-300 overflow-visible">
                            <!-- 顶部页签/标题 -->
                            <div class="px-4 py-3.5 border-b border-slate-100 flex items-center justify-between shrink-0">
                                <div class="flex items-center gap-2.5">
                                    <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-indigo-50 text-indigo-600 shadow-sm border border-indigo-100">
                                        <i class="fa fa-folder-open text-xs"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-[14px] font-bold text-slate-800">数据资源管理器</h3>
                                        <p class="text-[11px] text-slate-400">管理已上传的数据</p>
                                    </div>
                                </div>
                                <button id="removeAllFiles" class="hidden items-center gap-1 px-2 py-1 rounded-md text-[10px] font-medium text-red-600 bg-red-50 border border-red-200 hover:bg-red-100 transition-all" title="清除所有数据">
                                    <i class="fa fa-trash-alt text-[10px]"></i>
                                    <span>重置</span>
                                </button>
                            </div>

                            <!-- 文件列表区域 -->
                            <div id="fileList" class="flex-1 flex flex-col min-h-[280px] p-3">
                                <div class="px-2 py-1.5 mb-2 flex items-center justify-between">
                                    <span class="text-[10px] font-medium text-slate-400">文件队列</span>
                                    <span id="fileBadgeCount" class="px-1.5 py-0.5 rounded bg-slate-100 text-slate-500 text-[10px] font-medium">0</span>
                                </div>
                                <div class="flex-1 overflow-hidden px-1">
                                    <ul id="importedFiles" class="h-full space-y-1.5 overflow-y-auto scrollbar-thin scrollbar-thumb-slate-200 scrollbar-track-transparent pr-1">
                                        <li id="importedFilesEmpty" class="h-full flex flex-col items-center justify-center rounded-xl border border-dashed border-slate-200 bg-slate-50/50 p-6 text-center">
                                            <div class="w-12 h-12 rounded-xl bg-white border border-slate-100 flex items-center justify-center text-slate-300 mb-3">
                                                <i class="fa fa-file-import text-lg"></i>
                                            </div>
                                            <p class="text-[13px] font-semibold text-slate-600">尚未加载负荷数据</p>
                                            <p class="text-[11px] text-slate-400 mt-1 leading-relaxed">
                                                点击左侧按钮或将文件拖拽至此
                                            </p>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            <!-- 底部统计面板 -->
                            <div class="bg-slate-50 p-4 shrink-0 border-t border-slate-100 rounded-b-xl">
                                <div class="grid grid-cols-2 gap-3" id="dataStats">
                                    <div class="space-y-1">
                                        <div class="flex items-center gap-1 text-[10px] font-medium text-slate-400">
                                            <i class="fa fa-database text-slate-400 text-[9px]"></i>
                                            数据规模
                                        </div>
                                        <div class="flex items-baseline gap-1">
                                            <span id="fileCount" class="text-lg font-bold text-slate-700">0</span>
                                            <span class="text-[10px] text-slate-400">份文件</span>
                                        </div>
                                    </div>
                                    <div class="space-y-1 border-l border-slate-200 pl-3">
                                        <div class="flex items-center gap-1 text-[10px] font-medium text-slate-400">
                                            <i class="fa fa-calendar text-slate-400 text-[9px]"></i>
                                            覆盖周期
                                        </div>
                                        <div id="timeRange" class="text-[11px] font-medium text-slate-600 truncate">-</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 
            ==================== 第二部分：数据配置 ====================
            提供数据类型、结构、日期和列的配置选项
            使用可折叠面板组织配置项，提高界面整洁度
        -->
        <section id="configSection" class="mb-14 section-container section-hidden">
            <div class="relative overflow-hidden rounded-3xl border border-slate-200 bg-white shadow-soft">
                <div class="relative px-6 py-6 md:px-8 md:py-8">
                    <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
                        <div class="flex items-center gap-6">
                            <div class="relative flex h-14 w-14 shrink-0 items-center justify-center rounded-2xl bg-indigo-600 text-white shadow-xl shadow-indigo-200">
                                <div class="absolute inset-0 rounded-2xl opacity-30 blur-xl bg-indigo-400"></div>
                                <i class="fa fa-sliders-h text-xl relative"></i>
                            </div>
                            <div class="pt-1">
                                <h2 class="text-2xl font-black tracking-tight text-slate-900">数据配置</h2>
                                <p class="mt-1 text-slate-500 font-medium">用最少的选择，准确对齐日期、数值范围、倍率与过滤规则。</p>
                            </div>
                        </div>
                        <div class="flex flex-wrap items-center gap-3">
                            <span class="inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white/70 px-3 py-1.5 text-xs font-semibold text-slate-700">
                                <span id="step2Indicator" class="h-2 w-2 rounded-full bg-slate-400"></span>
                                Step 2
                            </span>
                            <div id="configStatus" class="inline-flex items-center gap-2 rounded-full border border-indigo-200/60 bg-indigo-50/70 px-4 py-1.5 text-xs font-semibold text-indigo-800">
                                <i class="fa fa-clock animate-spin-slow"></i>
                                <span>等待配置中...</span>
                            </div>
                        </div>
                    </div>

                    <div class="mt-7 space-y-6">
                        <!-- 第一排：核心配置 -->
                        <div class="grid grid-cols-1 gap-6 lg:grid-cols-3">
                            <!-- 数据类型 -->
                            <div class="group relative z-10 rounded-3xl border border-slate-200 bg-white shadow-sm transition-all duration-300 hover:shadow-medium hover:-translate-y-1 transform-gpu overflow-visible">
                                <div class="flex items-center justify-between px-6 py-5 border-b border-slate-50">
                                    <div class="flex items-center gap-4">
                                        <div class="grid h-12 w-12 place-items-center rounded-2xl bg-indigo-600/10 text-indigo-700 ring-1 ring-inset ring-indigo-200/60 transition-all duration-300 group-hover:bg-indigo-600 group-hover:text-white">
                                            <i class="fa fa-wave-square"></i>
                                        </div>
                                        <div>
                                            <div class="text-base font-extrabold text-slate-900">数据类型</div>
                                            <div class="text-xs text-slate-500">瞬时功率 / 累积电能</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="panel-content px-6 py-6" id="dataType-panel">
                                    <div class="space-y-3">
                                        <label class="group/opt relative flex cursor-pointer items-center gap-4 rounded-2xl border border-slate-200 bg-white px-4 py-4 transition-all hover:border-indigo-300 hover:bg-indigo-50/30 [&:has(input:checked)]:border-indigo-500 [&:has(input:checked)]:bg-indigo-50">
                                            <input type="radio" name="dataType" value="instantPower" class="peer sr-only" checked>
                                            <span class="grid h-6 w-6 place-items-center rounded-full border-2 border-slate-300 bg-white peer-checked:border-indigo-600 peer-checked:bg-indigo-600">
                                                <span class="h-2.5 w-2.5 rounded-full bg-white opacity-0 peer-checked:opacity-100"></span>
                                            </span>
                                            <span class="flex-1">
                                                <span class="block text-sm font-bold text-slate-800">瞬时功率</span>
                                                <span class="block text-xs text-slate-500">用于负荷曲线 P(t)</span>
                                            </span>
                                            <i class="fa fa-bolt text-slate-300 group-hover/opt:text-indigo-600"></i>
                                        </label>
                                        <label class="group/opt relative flex cursor-pointer items-center gap-4 rounded-2xl border border-slate-200 bg-white px-4 py-4 transition-all hover:border-indigo-300 hover:bg-indigo-50/30 [&:has(input:checked)]:border-indigo-500 [&:has(input:checked)]:bg-indigo-50">
                                            <input type="radio" name="dataType" value="cumulativeEnergy" class="peer sr-only">
                                            <span class="grid h-6 w-6 place-items-center rounded-full border-2 border-slate-300 bg-white peer-checked:border-indigo-600 peer-checked:bg-indigo-600">
                                                <span class="h-2.5 w-2.5 rounded-full bg-white opacity-0 peer-checked:opacity-100"></span>
                                            </span>
                                            <span class="flex-1">
                                                <span class="block text-sm font-bold text-slate-800">累积电能</span>
                                                <span class="block text-xs text-slate-500">用于电量推算 E(t)</span>
                                            </span>
                                            <i class="fa fa-battery-full text-slate-300 group-hover/opt:text-indigo-600"></i>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- 数据结构 -->
                            <div class="group rounded-3xl border border-slate-200 bg-white shadow-sm transition-all duration-300 hover:shadow-medium hover:-translate-y-1 transform-gpu overflow-visible">
                                <div class="flex items-center justify-between px-6 py-5 border-b border-slate-50">
                                    <div class="flex items-center gap-4">
                                        <div class="grid h-12 w-12 place-items-center rounded-2xl bg-indigo-600/10 text-indigo-700 ring-1 ring-inset ring-indigo-200/60 transition-all duration-300 group-hover:bg-indigo-600 group-hover:text-white">
                                            <i class="fa fa-table"></i>
                                        </div>
                                        <div>
                                            <div class="text-base font-extrabold text-slate-900">数据结构</div>
                                            <div class="text-xs text-slate-500">Wide / Long</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="panel-content px-6 py-6" id="dataStructure-panel">
                                    <div class="space-y-3">
                                        <label class="group/opt relative flex cursor-pointer items-center gap-4 rounded-2xl border border-slate-200 bg-white px-4 py-4 transition-all hover:border-indigo-300 hover:bg-indigo-50/30 [&:has(input:checked)]:border-indigo-500 [&:has(input:checked)]:bg-indigo-50">
                                            <input type="radio" name="dataStructure" value="columnToRow" class="peer sr-only" checked>
                                            <span class="grid h-6 w-6 place-items-center rounded-full border-2 border-slate-300 bg-white peer-checked:border-indigo-600 peer-checked:bg-indigo-600">
                                                <span class="h-2.5 w-2.5 rounded-full bg-white opacity-0 peer-checked:opacity-100"></span>
                                            </span>
                                            <span class="flex-1">
                                                <span class="block text-sm font-bold text-slate-800">列对行 (Wide)</span>
                                                <span class="block text-xs text-slate-500">日期列 + 多数据列</span>
                                            </span>
                                            <i class="fa fa-columns text-slate-300 group-hover/opt:text-indigo-700"></i>
                                        </label>
                                        <label class="group/opt relative flex cursor-pointer items-center gap-4 rounded-2xl border border-slate-200 bg-white px-4 py-4 transition-all hover:border-indigo-300 hover:bg-indigo-50/30 [&:has(input:checked)]:border-indigo-500 [&:has(input:checked)]:bg-indigo-50">
                                            <input type="radio" name="dataStructure" value="columnToColumn" class="peer sr-only">
                                            <span class="grid h-6 w-6 place-items-center rounded-full border-2 border-slate-300 bg-white peer-checked:border-indigo-600 peer-checked:bg-indigo-600">
                                                <span class="h-2.5 w-2.5 rounded-full bg-white opacity-0 peer-checked:opacity-100"></span>
                                            </span>
                                            <span class="flex-1">
                                                <span class="block text-sm font-bold text-slate-800">列对列 (Long)</span>
                                                <span class="block text-xs text-slate-500">日期列 + 单数据列</span>
                                            </span>
                                            <i class="fa fa-list text-slate-300 group-hover/opt:text-indigo-700"></i>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- 处理引擎 -->
                            <div class="group relative z-10 rounded-3xl border border-slate-200 bg-white shadow-sm transition-all duration-300 hover:shadow-medium hover:-translate-y-1 transform-gpu overflow-visible">
                                <div class="flex items-center justify-between px-6 py-5 border-b border-slate-50">
                                    <div class="flex items-center gap-4">
                                        <div class="grid h-12 w-12 place-items-center rounded-2xl bg-indigo-600/10 text-indigo-700 ring-1 ring-inset ring-indigo-200/60 group-hover:bg-indigo-600 group-hover:text-white transition-all">
                                            <i class="fa fa-microchip"></i>
                                        </div>
                                        <div>
                                            <div class="text-base font-extrabold text-slate-900">处理引擎</div>
                                            <div class="text-xs text-slate-500">异常处理与颗粒度</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="panel-content px-6 py-6" id="config-panel">
                                    <div class="space-y-4">
                                        <div>
                                            <label class="mb-2 block text-xs font-extrabold uppercase tracking-wider text-slate-500">异常数据处理</label>
                                            <select id="invalidDataHandling" class="w-full rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm font-semibold text-slate-800 outline-none transition-all focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10">
                                                <option value="ignore">忽略异常点</option>
                                                <option value="fill">智能邻域填充</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="mb-2 block text-xs font-extrabold uppercase tracking-wider text-slate-500">计算颗粒度</label>
                                            <select id="timeInterval" class="w-full rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm font-semibold text-slate-800 outline-none transition-all focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10">
                                                <option value="1">1分钟</option>
                                                <option value="5">5分钟</option>
                                                <option value="15" selected>15分钟</option>
                                                <option value="30">30分钟</option>
                                                <option value="60">60分钟</option>
                                            </select>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 第二排：字段映射 -->
                        <div class="grid grid-cols-1 gap-6 lg:grid-cols-12">
                            <!-- 字段映射 (12/12) -->
                            <div class="lg:col-span-12">
                                <div class="group relative z-10 rounded-3xl border border-slate-200 bg-white shadow-sm transition-all duration-300 hover:shadow-medium hover:-translate-y-1 h-full transform-gpu overflow-visible">
                                    <div class="flex items-center justify-between px-6 py-5 border-b border-slate-50">
                                        <div class="flex items-center gap-4">
                                            <div class="grid h-12 w-12 place-items-center rounded-2xl bg-indigo-600/10 text-indigo-700 ring-1 ring-inset ring-indigo-200/60 group-hover:bg-indigo-600 group-hover:text-white transition-all">
                                                <i class="fa fa-link"></i>
                                            </div>
                                            <div>
                                                <div class="text-base font-extrabold text-slate-900">字段映射</div>
                                                <div class="text-xs text-slate-500">日期、范围、倍率一体化设置</div>
                                            </div>
                                        </div>
                                        <div id="crossDateStructureContainer" class="hidden">
                                            <label class="flex cursor-pointer items-center gap-2.5 px-3 py-1.5 rounded-xl border border-slate-200 bg-white hover:bg-slate-50 transition-all shadow-sm">
                                                <input type="checkbox" id="crossDateStructure" class="h-4 w-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500">
                                                <span class="text-xs font-bold text-slate-700">开启跨日期逻辑</span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="panel-content px-6 py-6" id="columns-panel">
                                        <!-- 原始数据结构预览 -->
                                        <div id="rawDataPreviewContainer" class="mb-6">
                                            <!-- 原始数据预览将在这里动态生成 -->
                                        </div>
                                        
                                        <div class="grid grid-cols-1 gap-6 lg:grid-cols-2 items-start">
                                            <!-- 左侧：索引与范围配置 -->
                                            <div class="space-y-5" id="date-panel">
                                                <!-- 日期与时间 -->
                                                <div class="space-y-2.5">
                                                    <label class="flex items-center gap-2 text-xs font-bold uppercase tracking-wider text-slate-500">
                                                        <i class="fa fa-calendar-day text-indigo-500/70"></i>
                                                        日期/时间索引列
                                                    </label>
                                                    <div class="relative group">
                                                        <select id="dateColumn" class="w-full appearance-none rounded-xl border border-slate-200 bg-white pl-4 pr-10 py-3 text-sm font-bold text-slate-700 outline-none transition-all hover:border-indigo-300 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 shadow-sm">
                                                            <option value="">自动识别日期</option>
                                                        </select>
                                                        <div class="pointer-events-none absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 group-hover:text-indigo-500 transition-colors">
                                                            <i class="fa fa-chevron-down text-xs"></i>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- 数值范围选择 -->
                                                <div class="space-y-2.5">
                                                    <label class="flex items-center gap-2 text-xs font-bold uppercase tracking-wider text-slate-500">
                                                        <i class="fa fa-layer-group text-indigo-500/70"></i>
                                                        负荷数值列范围
                                                    </label>
                                                    <div class="flex items-center gap-2">
                                                        <div class="relative flex-1 group">
                                                            <select id="dataStartColumn" class="w-full appearance-none rounded-xl border border-slate-200 bg-white pl-4 pr-10 py-3 text-sm font-bold text-slate-700 outline-none transition-all hover:border-indigo-300 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 shadow-sm" title="选择起始负荷列">
                                                                <option value="">起始列</option>
                                                            </select>
                                                            <div class="pointer-events-none absolute right-4 top-1/2 -translate-y-1/2 text-slate-300 group-hover:text-indigo-500 transition-colors">
                                                                <i class="fa fa-play text-xs"></i>
                                                            </div>
                                                        </div>
                                                        <div class="text-slate-300 flex-shrink-0">
                                                            <i class="fa fa-arrow-right text-xs"></i>
                                                        </div>
                                                        <div class="relative flex-1 group">
                                                            <select id="dataEndColumn" class="w-full appearance-none rounded-xl border border-slate-200 bg-white pl-4 pr-10 py-3 text-sm font-bold text-slate-700 outline-none transition-all hover:border-indigo-300 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 shadow-sm" title="选择结束负荷列">
                                                                <option value="">结束列</option>
                                                            </select>
                                                            <div class="pointer-events-none absolute right-4 top-1/2 -translate-y-1/2 text-slate-300 group-hover:text-indigo-500 transition-colors">
                                                                <i class="fa fa-stop text-xs"></i>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <p class="text-xs text-slate-400 pl-1 italic leading-relaxed">通常选择第 1 个时间点到最后 1 个时间点对应的列。</p>
                                                </div>
                                            </div>

                                            <!-- 右侧：倍率配置 (与左侧对齐) -->
                                            <div class="space-y-5">
                                                <!-- 倍率配置分组 -->
                                                <div class="space-y-2.5">
                                                    <!-- 标题行：与左侧日期/时间索引列对齐 -->
                                                    <div class="flex items-center justify-between">
                                                        <div class="flex items-center gap-2 relative">
                                                            <label class="flex items-center gap-2 text-xs font-bold uppercase tracking-wider text-slate-500">
                                                                <i class="fa fa-calculator text-indigo-600/70"></i>
                                                                倍率配置
                                                            </label>
                                                            <!-- 倍率模式选择（绝对定位，不影响布局） -->
                                                            <div id="multiplierModeSelector" class="hidden absolute left-full ml-2 top-1/2 -translate-y-1/2 flex gap-1 p-0.5 bg-slate-100 rounded-md transition-all duration-200 z-10 whitespace-nowrap">
                                                                <button type="button" id="multiplierModeSingle" class="px-2 py-0.5 text-[10px] font-bold rounded transition-all bg-white text-indigo-600 shadow-sm whitespace-nowrap" onclick="setMultiplierMode('single')">
                                                                    单列
                                                                </button>
                                                                <button type="button" id="multiplierModePtCt" class="px-2 py-0.5 text-[10px] font-bold rounded transition-all text-slate-500 hover:text-slate-700 whitespace-nowrap" onclick="setMultiplierMode('ptct')">
                                                                    PT×CT
                                                                </button>
                                                            </div>
                                                        </div>
                                                        <div class="flex items-center gap-2">
                                                            <span class="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">使用倍率列</span>
                                                            <label class="relative inline-flex cursor-pointer items-center">
                                                                <input type="checkbox" id="useMultiplierColumn" class="peer sr-only">
                                                                <span class="h-4 w-7 rounded-full bg-slate-200 transition-all after:absolute after:left-[2px] after:top-[2px] after:h-3 after:w-3 after:rounded-full after:border after:border-slate-300 after:bg-white after:transition-all after:content-[''] peer-checked:bg-indigo-600 peer-checked:after:translate-x-3 peer-checked:after:border-white shadow-inner"></span>
                                                            </label>
                                                        </div>
                                                    </div>

                                                    <div id="multiplierContent" class="space-y-2">
                                                        <!-- 固定倍率 -->
                                                        <div id="multiplierOptions" class="animate-fade-in">
                                                            <div class="relative group/input">
                                                                <input type="number" id="multiplier" value="1.0" step="0.01" min="0.01" class="w-full rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm font-bold text-slate-700 outline-none transition-all hover:border-indigo-300 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 shadow-sm" placeholder="固定倍率数值">
                                                            </div>
                                                        </div>

                                                        <!-- 动态倍率列 -->
                                                        <div id="multiplierColumnOption" class="hidden animate-fade-in">

                                                            <!-- 单列倍率选择 -->
                                                            <div id="singleMultiplierSection" class="relative group">
                                                                <select id="multiplierColumn" class="w-full appearance-none rounded-xl border border-slate-200 bg-white pl-4 pr-10 py-3 text-sm font-bold text-slate-700 outline-none transition-all hover:border-indigo-300 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 shadow-sm">
                                                                    <option value="">选择倍率列</option>
                                                                </select>
                                                                <div class="pointer-events-none absolute right-4 top-1/2 -translate-y-1/2 text-slate-300 group-hover:text-indigo-500 transition-colors">
                                                                    <i class="fa fa-chevron-down text-xs"></i>
                                                                </div>
                                                            </div>

                                                            <!-- PT × CT 分开选择 -->
                                                            <div id="ptCtMultiplierSection" class="hidden">
                                                                <div class="flex items-start gap-2">
                                                                    <div class="relative group flex-1">
                                                                        <select id="ptColumn" class="w-full appearance-none rounded-xl border border-slate-200 bg-white pl-4 pr-8 py-3 text-sm font-bold text-slate-700 outline-none transition-all hover:border-indigo-300 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 shadow-sm">
                                                                            <option value="">PT列</option>
                                                                        </select>
                                                                        <div class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-slate-300 group-hover:text-indigo-500 transition-colors">
                                                                            <i class="fa fa-chevron-down text-xs"></i>
                                                                        </div>
                                                                    </div>
                                                                    <span class="text-slate-400 font-bold text-sm mt-3">×</span>
                                                                    <div class="relative group flex-1">
                                                                        <select id="ctColumn" class="w-full appearance-none rounded-xl border border-slate-200 bg-white pl-4 pr-8 py-3 text-sm font-bold text-slate-700 outline-none transition-all hover:border-indigo-300 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 shadow-sm">
                                                                            <option value="">CT列</option>
                                                                        </select>
                                                                        <div class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-slate-300 group-hover:text-indigo-500 transition-colors">
                                                                            <i class="fa fa-chevron-down text-xs"></i>
                                                                        </div>
                                                                    </div>
                                                                    <!-- 预览值移到右侧，顶部对齐 -->
                                                                    <div id="ptCtPreview" class="text-xs text-indigo-600 font-bold whitespace-nowrap bg-indigo-50 border border-indigo-200 px-2 py-3 rounded-xl min-w-[3rem] text-center h-[46px] flex items-center justify-center box-border">= 1</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- 计量点筛选配置 -->
                                                <div class="space-y-2.5">
                                                    <div class="flex items-center justify-between h-4">
                                                        <label class="flex items-center gap-2 text-xs font-bold uppercase tracking-wider text-slate-500">
                                                                <i class="fa fa-crosshairs text-indigo-600/70"></i>
                                                                计量点筛选配置
                                                            </label>
                                                            <button id="openAdvancedFilters" class="flex items-center gap-1 px-3 py-1 rounded-xl bg-white border border-slate-200 text-[11px] font-bold text-slate-500 transition-all hover:border-indigo-300 hover:text-indigo-600 hover:shadow-sm">
                                                            更多
                                                            <i class="fa fa-chevron-right text-[9px]"></i>
                                                        </button>
                                                    </div>
                                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                        <div class="relative group">
                                                            <select id="meteringPointColumn" class="w-full appearance-none rounded-xl border border-slate-200 bg-white pl-4 pr-14 py-3 text-sm font-bold text-slate-700 outline-none transition-all hover:border-indigo-300 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 shadow-sm">
                                                                <option value="">计量点列</option>
                                                            </select>
                                                            <div class="pointer-events-none absolute right-10 top-1/2 -translate-y-1/2 text-slate-300 group-hover:text-indigo-500 transition-colors">
                                                                <i class="fa fa-chevron-down text-xs"></i>
                                                            </div>
                                                            <button id="clearMeteringPointColumn" class="absolute right-2 top-1/2 -translate-y-1/2 grid h-6 w-6 place-items-center rounded-lg border border-slate-200 bg-white text-slate-400 transition-all hover:border-indigo-200 hover:bg-indigo-50 hover:text-indigo-600" title="清空选择">
                                                                <i class="fa fa-times text-[10px]"></i>
                                                            </button>
                                                        </div>
                                                        <div class="relative group">
                                                            <select id="meteringPointFilter" class="w-full appearance-none rounded-xl border border-slate-200 bg-white pl-4 pr-14 py-3 text-sm font-bold text-slate-700 outline-none transition-all hover:border-indigo-300 focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 shadow-sm">
                                                                <option value="">计量编号</option>
                                                            </select>
                                                            <div class="pointer-events-none absolute right-10 top-1/2 -translate-y-1/2 text-slate-300 group-hover:text-indigo-500 transition-colors">
                                                                <i class="fa fa-chevron-down text-xs"></i>
                                                            </div>
                                                            <button id="clearMeteringPointFilter" class="absolute right-2 top-1/2 -translate-y-1/2 grid h-6 w-6 place-items-center rounded-lg border border-slate-200 bg-white text-slate-400 transition-all hover:border-indigo-200 hover:bg-indigo-50 hover:text-indigo-600" title="清空选择">
                                                                <i class="fa fa-times text-[10px]"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <!-- 第三排：实时预览 -->
                        <div class="grid grid-cols-1">
                            <div id="dataPreviewContainer" class="transition-all duration-300">
                                <div id="dataPreview" class="min-h-[320px] w-full transition-all duration-500">
                                    <!-- 空状态 -->
                                    <div class="flex flex-col items-center justify-center py-16 text-center bg-gradient-to-br from-slate-50 to-white rounded-2xl border border-dashed border-slate-200">
                                        <div class="w-16 h-16 mb-5 rounded-2xl bg-white border border-slate-100 flex items-center justify-center text-slate-300 shadow-sm">
                                            <i class="fa fa-table text-2xl"></i>
                                        </div>
                                        <h3 class="text-base font-semibold text-slate-700 mb-2">等待数据导入</h3>
                                        <p class="text-sm text-slate-400 max-w-[220px] leading-relaxed">
                                            导入数据后，系统将自动识别并在此展示实时预览
                                        </p>
                                    </div>
                                </div>
                                
                                <!-- 计算结果按钮区域 -->
                                <div id="previewButtons" class="mt-5 hidden">
                                    <div class="flex items-center gap-3">
                                        <button id="previewFirstHourCalculation" disabled class="group flex items-center gap-2.5 px-4 py-2.5 rounded-xl bg-white border border-slate-200 text-sm font-medium text-slate-600 transition-all hover:border-indigo-300 hover:bg-indigo-50 hover:text-indigo-600 disabled:opacity-40 disabled:cursor-not-allowed shadow-sm">
                                            <div class="w-8 h-8 rounded-lg bg-indigo-50 flex items-center justify-center group-hover:bg-indigo-100 transition-colors">
                                                <i class="fa fa-calculator text-indigo-500 text-xs"></i>
                                            </div>
                                            <span>首小时计算结果</span>
                                        </button>
                                        <button id="previewFirstDayCalculation" disabled class="group flex items-center gap-2.5 px-4 py-2.5 rounded-xl bg-white border border-slate-200 text-sm font-medium text-slate-600 transition-all hover:border-indigo-300 hover:bg-indigo-50/50 hover:text-indigo-600 disabled:opacity-40 disabled:cursor-not-allowed shadow-sm">
                                            <div class="w-8 h-8 rounded-lg bg-indigo-50 flex items-center justify-center group-hover:bg-indigo-100 transition-colors">
                                                <i class="fa fa-calendar-day text-slate-500 text-xs"></i>
                                            </div>
                                            <span>首日计算结果</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 
            ==================== 第三部分：可视化 ====================
            提供负荷曲线可视化功能，包括日期范围筛选和时段聚焦
            使用响应式网格布局，适应不同屏幕尺寸
        -->
        <section id="visualizationSection" class="mb-14 section-container section-hidden">
            <div class="relative overflow-hidden rounded-3xl border border-slate-200 bg-white shadow-soft">
                <div class="relative px-6 py-6 md:px-8 md:py-8">
                    <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
                        <div class="flex items-center gap-6">
                            <div class="relative flex h-14 w-14 shrink-0 items-center justify-center rounded-2xl bg-indigo-600 text-white shadow-xl shadow-indigo-200">
                                <div class="absolute inset-0 rounded-2xl opacity-30 blur-xl bg-indigo-400"></div>
                                <i class="fa fa-chart-line text-xl relative"></i>
                            </div>
                            <div class="pt-1">
                                <h2 class="text-2xl font-black tracking-tight text-slate-900">可视化</h2>
                                <p class="mt-1 text-slate-500 font-medium">用时段聚焦与样式控制，把趋势读清楚。</p>
                            </div>
                        </div>
                        <div class="flex flex-wrap items-center gap-2">
                            <span class="inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white/70 px-3 py-1.5 text-xs font-semibold text-slate-700">
                                <span id="step3Indicator" class="h-2 w-2 rounded-full bg-slate-400"></span>
                                Step 3
                            </span>
                        </div>
                    </div>

                    <div class="mt-8 grid grid-cols-1 gap-8 lg:grid-cols-12 items-stretch">
                        <div class="flex h-full flex-col rounded-3xl border border-slate-200 bg-white shadow-sm lg:col-span-8" id="heatmapSection" style="min-height: 480px;">
                            <div class="flex items-center justify-between px-6 py-4">
                                        <div class="flex items-center gap-3">
                                            <div class="grid h-10 w-10 place-items-center rounded-2xl bg-orange-600/10 text-orange-700 ring-1 ring-inset ring-orange-200/60">
                                                <i class="fa fa-th"></i>
                                            </div>
                                            <div>
                                                <div class="text-base font-extrabold text-slate-900">年度负荷热力图</div>
                                                <div class="text-xs text-slate-500">点击条带跳转到该日期</div>
                                            </div>
                                        </div>
                                <div class="flex items-center justify-end gap-3 text-[11px] font-bold text-slate-400" id="heatmapLegend">
                                    <span>低</span>
                                    <div class="h-2.5 w-32 rounded-full bg-gradient-to-r from-[#dbeafe] via-[#fde047] to-[#f87171] shadow-inner opacity-90"></div>
                                    <span>高</span>
                                </div>
                            </div>
                            <div class="flex-1 px-4 pb-3 md:px-6 md:pb-4">
                                <div class="relative h-full overflow-y-auto overflow-x-hidden border border-slate-200/60 rounded-2xl bg-white" id="heatmapContainer" style="max-height: 450px; min-height: 400px;">
                                    <canvas id="loadHeatmap" class="mx-auto"></canvas>

                                    <div id="heatmapTooltip" class="absolute hidden z-20 pointer-events-none rounded-xl border border-slate-200 bg-white px-3 py-2 text-xs font-bold text-slate-800 shadow-soft">
                                        <div id="heatmapTooltipTitle" class="text-xs font-extrabold text-slate-900"></div>
                                        <div id="heatmapTooltipValue" class="mt-0.5 text-xs font-bold text-slate-700"></div>
                                    </div>

                                    <div id="heatmapLoading" class="absolute inset-0 bg-white/90 backdrop-blur-md flex items-center justify-center rounded-2xl hidden">
                                        <div class="text-center">
                                            <div class="mx-auto mb-4 h-12 w-12 rounded-2xl border-4 border-indigo-200 border-t-indigo-600 animate-spin"></div>
                                            <p class="text-sm font-semibold text-slate-700">正在生成热力图...</p>
                                        </div>
                                    </div>

                                    <div id="heatmapNoDataMessage" class="absolute inset-0 bg-white/90 backdrop-blur-md flex items-center justify-center rounded-2xl hidden">
                                        <div class="text-center">
                                            <div class="mx-auto mb-4 grid h-14 w-14 place-items-center rounded-2xl bg-slate-100 text-slate-400">
                                                <i class="fa fa-th text-xl"></i>
                                            </div>
                                            <p class="text-sm font-semibold text-slate-700">暂无热力图数据</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="lg:col-span-4">
                            <div class="grid h-full grid-cols-1 gap-8 items-stretch">
                                <!-- 时段聚焦卡片 -->
                                <div class="group relative z-10 flex flex-col rounded-2xl border border-slate-200/80 bg-white shadow-sm transition-all duration-300 hover:shadow-medium hover:-translate-y-1 transform-gpu overflow-visible">
                                    <!-- 卡片头部 -->
                                    <div class="flex items-center gap-3 px-5 py-4 border-b border-slate-100">
                                        <div class="flex h-9 w-9 items-center justify-center rounded-xl bg-gradient-to-br from-indigo-500 to-indigo-600 text-white shadow-sm shadow-indigo-200">
                                            <i class="fa fa-clock text-sm"></i>
                                        </div>
                                        <div>
                                            <h3 class="text-[15px] font-bold text-slate-800 leading-tight">时段聚焦</h3>
                                            <p class="text-[11px] text-slate-400 mt-0.5">关键小时区间</p>
                                        </div>
                                    </div>
                                    
                                    <!-- 卡片内容 -->
                                    <div class="px-5 py-4 space-y-4">
                                        <!-- 时间选择器 -->
                                        <div class="flex items-center gap-3">
                                            <div class="flex-1">
                                                <label class="block text-[11px] font-medium text-slate-500 mb-1.5">开始时段</label>
                                                <div class="relative">
                                                    <select id="focusStartTime" class="w-full appearance-none rounded-lg border border-slate-200 bg-slate-50/50 px-3 py-2.5 text-[13px] font-semibold text-slate-700 outline-none transition-all hover:border-indigo-300 hover:bg-white focus:border-indigo-500 focus:bg-white focus:ring-2 focus:ring-indigo-500/20">
                                                        <option value="0">00:00</option>
                                                        <option value="1">01:00</option>
                                                        <option value="2">02:00</option>
                                                        <option value="3">03:00</option>
                                                        <option value="4">04:00</option>
                                                        <option value="5">05:00</option>
                                                        <option value="6">06:00</option>
                                                        <option value="7">07:00</option>
                                                        <option value="8">08:00</option>
                                                        <option value="9">09:00</option>
                                                        <option value="10">10:00</option>
                                                        <option value="11">11:00</option>
                                                        <option value="12">12:00</option>
                                                        <option value="13">13:00</option>
                                                        <option value="14">14:00</option>
                                                        <option value="15">15:00</option>
                                                        <option value="16">16:00</option>
                                                        <option value="17">17:00</option>
                                                        <option value="18">18:00</option>
                                                        <option value="19">19:00</option>
                                                        <option value="20">20:00</option>
                                                        <option value="21">21:00</option>
                                                        <option value="22">22:00</option>
                                                        <option value="23">23:00</option>
                                                    </select>
                                                    <i class="fa fa-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-[10px] text-slate-400 pointer-events-none"></i>
                                                </div>
                                            </div>
                                            
                                            <!-- 连接符 -->
                                            <div class="pt-5 text-slate-300">
                                                <i class="fa fa-minus text-xs"></i>
                                            </div>
                                            
                                            <div class="flex-1">
                                                <label class="block text-[11px] font-medium text-slate-500 mb-1.5">结束时段</label>
                                                <div class="relative">
                                                    <select id="focusEndTime" class="w-full appearance-none rounded-lg border border-slate-200 bg-slate-50/50 px-3 py-2.5 text-[13px] font-semibold text-slate-700 outline-none transition-all hover:border-indigo-300 hover:bg-white focus:border-indigo-500 focus:bg-white focus:ring-2 focus:ring-indigo-500/20">
                                                        <option value="0">00:00</option>
                                                        <option value="1">01:00</option>
                                                        <option value="2">02:00</option>
                                                        <option value="3">03:00</option>
                                                        <option value="4">04:00</option>
                                                        <option value="5">05:00</option>
                                                        <option value="6">06:00</option>
                                                        <option value="7">07:00</option>
                                                        <option value="8">08:00</option>
                                                        <option value="9">09:00</option>
                                                        <option value="10">10:00</option>
                                                        <option value="11">11:00</option>
                                                        <option value="12">12:00</option>
                                                        <option value="13">13:00</option>
                                                        <option value="14">14:00</option>
                                                        <option value="15">15:00</option>
                                                        <option value="16">16:00</option>
                                                        <option value="17">17:00</option>
                                                        <option value="18">18:00</option>
                                                        <option value="19">19:00</option>
                                                        <option value="20">20:00</option>
                                                        <option value="21">21:00</option>
                                                        <option value="22">22:00</option>
                                                        <option value="23" selected="">23:00</option>
                                                    </select>
                                                    <i class="fa fa-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-[10px] text-slate-400 pointer-events-none"></i>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- 全天数据按钮 -->
                                        <button id="resetTimeFocus" class="w-full flex items-center justify-center gap-2 rounded-lg border border-slate-200 bg-white px-4 py-2.5 text-[13px] font-semibold text-slate-600 transition-all hover:bg-slate-50 hover:border-slate-300 hover:text-slate-800 active:scale-[0.98]">
                                            <i class="fa fa-rotate-left text-indigo-500 text-xs"></i>
                                            全天数据
                                        </button>
                                    </div>
                                </div>

                                <!-- 过滤卡片 -->
                                <div class="group relative z-10 flex flex-col rounded-2xl border border-slate-200/80 bg-white shadow-sm transition-all duration-300 hover:shadow-medium hover:-translate-y-1 transform-gpu overflow-visible">
                                    <!-- 卡片头部 -->
                                    <div class="flex items-center justify-between px-5 py-4 border-b border-slate-100">
                                        <div class="flex items-center gap-3">
                                            <div class="flex h-9 w-9 items-center justify-center rounded-xl bg-gradient-to-br from-indigo-500 to-indigo-600 text-white shadow-sm shadow-indigo-200">
                                                <i class="fa fa-filter text-sm"></i>
                                            </div>
                                            <div>
                                                <h3 class="text-[15px] font-bold text-slate-800 leading-tight">过滤</h3>
                                                <p class="text-[11px] text-slate-400 mt-0.5">计量点与规则</p>
                                            </div>
                                        </div>
                                        <button id="openAdvancedFilters_v2" class="flex items-center gap-1 px-3 py-1 rounded-xl bg-white border border-slate-200 text-[11px] font-bold text-slate-500 transition-all hover:border-indigo-300 hover:text-indigo-600 hover:shadow-sm">
                                            更多
                                            <i class="fa fa-chevron-right text-[9px]"></i>
                                        </button>
                                    </div>
                                    
                                    <!-- 卡片内容 -->
                                    <div class="px-5 py-4 space-y-4">
                                        <!-- 日期范围选择 -->
                                        <div>
                                            <label class="block text-[11px] font-medium text-slate-500 mb-1.5">日期范围</label>
                                            <div class="flex items-center gap-2">
                                                <button id="prevDayBtn" class="flex h-8 w-8 shrink-0 items-center justify-center rounded-lg border border-slate-200 bg-white text-slate-400 transition-all hover:border-slate-300 hover:text-slate-600 hover:bg-slate-50 active:scale-95">
                                                    <i class="fa fa-chevron-left text-[10px]"></i>
                                                </button>
                                                <div class="flex-1 grid grid-cols-2 gap-2">
                                                    <div class="relative">
                                                        <select id="startDateInput" class="w-full appearance-none rounded-lg border border-slate-200 bg-slate-50/50 px-2.5 py-2 text-[12px] font-medium text-slate-700 outline-none transition-all hover:border-indigo-300 hover:bg-white focus:border-indigo-500 focus:bg-white focus:ring-2 focus:ring-indigo-500/20">
                                                            <option value="">起始日期</option>
                                                        </select>
                                                        <i class="fa fa-chevron-down absolute right-2 top-1/2 -translate-y-1/2 text-[9px] text-slate-400 pointer-events-none"></i>
                                                    </div>
                                                    <div class="relative">
                                                        <select id="endDateInput" class="w-full appearance-none rounded-lg border border-slate-200 bg-slate-50/50 px-2.5 py-2 text-[12px] font-medium text-slate-700 outline-none transition-all hover:border-indigo-300 hover:bg-white focus:border-indigo-500 focus:bg-white focus:ring-2 focus:ring-indigo-500/20">
                                                            <option value="">结束日期</option>
                                                        </select>
                                                        <i class="fa fa-chevron-down absolute right-2 top-1/2 -translate-y-1/2 text-[9px] text-slate-400 pointer-events-none"></i>
                                                    </div>
                                                </div>
                                                <button id="nextDayBtn" class="flex h-8 w-8 shrink-0 items-center justify-center rounded-lg border border-slate-200 bg-white text-slate-400 transition-all hover:border-slate-300 hover:text-slate-600 hover:bg-slate-50 active:scale-95">
                                                    <i class="fa fa-chevron-right text-[10px]"></i>
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <!-- 计量点筛选 -->
                                        <div class="grid grid-cols-2 gap-3">
                                            <div>
                                                <label class="block text-[11px] font-medium text-slate-500 mb-1.5">计量点列</label>
                                                <div class="relative">
                                                    <select id="meteringPointColumn_v2" class="w-full appearance-none rounded-lg border border-slate-200 bg-slate-50/50 pl-2.5 pr-7 py-2 text-[12px] font-medium text-slate-700 outline-none transition-all hover:border-indigo-300 hover:bg-white focus:border-indigo-500 focus:bg-white focus:ring-2 focus:ring-indigo-500/20">
                                                        <option value="">选择列</option>
                                                    </select>
                                                    <i class="fa fa-chevron-down absolute right-2 top-1/2 -translate-y-1/2 text-[9px] text-slate-400 pointer-events-none"></i>
                                                </div>
                                            </div>
                                            <div>
                                                <label class="block text-[11px] font-medium text-slate-500 mb-1.5">计量编号</label>
                                                <div class="relative">
                                                    <select id="meteringPointFilter_v2" class="w-full appearance-none rounded-lg border border-slate-200 bg-slate-50/50 pl-2.5 pr-7 py-2 text-[12px] font-medium text-slate-700 outline-none transition-all hover:border-indigo-300 hover:bg-white focus:border-indigo-500 focus:bg-white focus:ring-2 focus:ring-indigo-500/20">
                                                        <option value="">选择编号</option>
                                                    </select>
                                                    <i class="fa fa-chevron-down absolute right-2 top-1/2 -translate-y-1/2 text-[9px] text-slate-400 pointer-events-none"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 space-y-6">
                        <!-- 24小时负荷曲线图表 - 简化容器结构 -->
                        <div class="rounded-xl border border-slate-200/80 bg-white shadow-sm p-4 md:p-5 transition-none transform-none" id="loadCurveChartSection">
                            <div class="flex flex-col gap-4 mb-4 sm:flex-row sm:items-center sm:justify-between border-b border-slate-100 pb-4">
                                <div class="flex items-center gap-3">
                                    <div class="flex h-9 w-9 items-center justify-center rounded-lg bg-indigo-50 text-indigo-600 shadow-sm border border-indigo-100">
                                        <i class="fa fa-chart-line text-sm"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-sm font-semibold text-slate-800">24小时负荷曲线</h3>
                                        <p class="text-xs text-slate-400 mt-0.5">支持图例与汇总模式</p>
                                    </div>
                                </div>
                                <div class="flex flex-wrap items-center gap-2">
                                    <label for="toggleCurveLegend" class="inline-flex cursor-pointer items-center gap-2 rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-xs font-medium text-slate-600 hover:bg-slate-50 transition">
                                        <input type="checkbox" id="toggleCurveLegend" class="h-3.5 w-3.5 rounded border-slate-300 text-slate-800 focus:ring-slate-500">
                                        显示图例
                                    </label>
                                    <button id="openCurveStyleBtn" class="inline-flex items-center gap-1.5 rounded-lg border border-slate-200 bg-white text-slate-600 px-3 py-1.5 text-xs font-medium hover:bg-slate-50 transition">
                                        <i class="fa fa-palette text-xs"></i>
                                        <span>曲线样式</span>
                                    </button>
                                    <button id="toggleAllCurves" class="inline-flex items-center gap-1.5 rounded-lg border border-slate-200 px-3 py-1.5 text-xs font-medium transition">
                                        <i class="fa-solid fa-calendar-days text-xs"></i>
                                        <span>显示全部日期</span>
                                    </button>
                                    <button id="toggleSummaryMode" class="inline-flex items-center gap-1.5 rounded-lg bg-gradient-to-br from-indigo-600 to-indigo-700 text-white px-3 py-1.5 text-xs font-medium hover:from-indigo-700 hover:to-indigo-800 transition shadow-sm shadow-indigo-100">
                                        <i class="fa fa-layer-group text-xs"></i>
                                        <span>汇总曲线</span>
                                    </button>
                                    
                                    <!-- 汇总子模式切换下拉菜单 -->
                                    <select id="summarySubModeGroup" class="hidden h-8 rounded-lg border border-slate-200 bg-white px-2.5 text-xs font-medium text-slate-600 outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all ml-1 cursor-pointer hover:border-slate-300">
                                        <option value="all" selected>显示全部数据</option>
                                        <option value="extreme">极值/平均模式</option>
                                        <option value="quarter">季度分布视图</option>
                                        <option value="month">月份趋势视图</option>
                                    </select>
                                    
                                    <button id="aiAnalyzeBtn" class="inline-flex items-center gap-1.5 rounded-lg bg-gradient-to-br from-indigo-600 to-indigo-700 text-white px-3 py-1.5 text-xs font-medium hover:from-indigo-700 hover:to-indigo-800 transition shadow-sm shadow-indigo-100" title="AI智能分析">
                                        <i class="fa fa-robot text-xs"></i>
                                        <span>AI分析</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- AI工程师助手面板 -->
                            <div id="aiAnalysisPanel" class="hidden mb-6 rounded-2xl border border-indigo-100 bg-white shadow-sm overflow-hidden">
                                <div class="flex items-center justify-between px-5 py-3.5 bg-slate-50/50 border-b border-slate-100">
                                    <div class="flex items-center gap-2.5">
                                        <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-indigo-600 text-white shadow-sm shadow-indigo-100">
                                            <i class="fa fa-robot text-sm"></i>
                                        </div>
                                        <span class="text-[15px] font-bold text-slate-800">AI 工程师助手</span>
                                        <button id="openAiSettings" class="ml-1 text-slate-400 hover:text-indigo-600 transition-colors p-1" title="配置 API">
                                            <i class="fa fa-cog text-xs"></i>
                                        </button>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <button id="runAiAnalysisBtn" class="px-4 py-1.5 rounded-lg bg-indigo-600 text-white text-xs font-bold hover:bg-indigo-700 transition-all shadow-sm shadow-indigo-100 flex items-center gap-2">
                                            <i class="fa fa-wand-magic-sparkles"></i>
                                            <span>分析当前数据</span>
                                        </button>
                                        <button id="closeAiPanel" class="h-8 w-8 flex items-center justify-center rounded-lg text-slate-400 hover:bg-slate-100 hover:text-slate-600 transition-all">
                                            <i class="fa fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                                <div id="aiAnalysisContent" class="p-6 text-[14px] text-slate-700 leading-relaxed min-h-[120px] max-h-[500px] overflow-y-auto custom-scrollbar">
                                    <div class="flex flex-col items-center justify-center py-4 text-slate-400">
                                        <i class="fa fa-comment-dots text-2xl mb-2 opacity-20"></i>
                                        <p class="text-xs">点击“分析当前数据”按钮，获取资深工程师的专业见解</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="relative h-[480px] md:h-[580px] lg:h-[680px]" id="chartContainer">
                                <canvas id="loadCurveChart" class="w-full h-full rounded-xl cursor-crosshair"></canvas>

                                <div class="absolute top-4 right-4 rounded-xl border border-slate-200 bg-white/90 p-3 shadow-sm backdrop-blur-sm" id="curveLegendContainer" style="display: none;"></div>

                                <div id="chartLoading" class="absolute inset-0 bg-white/90 backdrop-blur-md flex items-center justify-center rounded-xl hidden">
                                    <div class="text-center">
                                        <div class="mx-auto mb-4 h-10 w-10 rounded-xl border-4 border-slate-200 border-t-slate-600 animate-spin"></div>
                                        <p class="text-sm font-medium text-slate-600">正在生成24小时负荷曲线...</p>
                                    </div>
                                </div>

                                <div id="noDataMessage" class="absolute inset-0 bg-white/90 backdrop-blur-md flex items-center justify-center rounded-xl hidden">
                                    <div class="text-center">
                                        <div class="mx-auto mb-4 flex h-14 w-14 items-center justify-center rounded-xl bg-slate-50 border border-slate-200 text-slate-300">
                                            <i class="fa fa-chart-line text-2xl"></i>
                                        </div>
                                        <p class="text-sm font-medium text-slate-600">暂无24小时负荷数据</p>
                                        <p class="mt-1 text-xs text-slate-400">请检查数据导入与筛选条件</p>
                                    </div>
                                </div>

                                <div id="chartTooltip" class="absolute hidden z-20 pointer-events-none max-w-xs rounded-xl border border-slate-700/40 bg-slate-900/95 px-4 py-3 text-white shadow-lg backdrop-blur-sm">
                                    <div class="font-semibold text-sm" id="tooltipTitle"></div>
                                    <div class="mt-1 text-xs text-slate-200" id="tooltipValue"></div>
                                    <div class="mt-1.5 text-xs text-slate-400" id="tooltipTime"></div>
                                </div>
                            </div>
                        </div>

                        <!-- 日期总用电量图表 -->
                        <div class="rounded-xl border border-slate-200/80 bg-white shadow-sm dashboard-section transition-none transform-none" id="dailyTotalBarChartSection">
                            <div class="flex flex-col gap-4 px-5 py-4 sm:flex-row sm:items-center sm:justify-between border-b border-slate-100">
                                <div class="flex items-center gap-3">
                                    <div class="flex h-9 w-9 items-center justify-center rounded-lg bg-indigo-50 text-indigo-600 shadow-sm border border-indigo-100">
                                        <i class="fa fa-chart-bar text-sm"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-sm font-semibold text-slate-800">日期总用电量</h3>
                                        <p class="text-xs text-slate-400 mt-0.5">按日 / 按月聚合对比</p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-1 bg-slate-100/80 p-1 rounded-xl" id="barChartAggregationControls">
                                    <button id="barChartAggregationDailyBtn" class="rounded-lg px-4 py-1.5 text-xs font-bold transition-all duration-200">按日</button>
                                    <button id="barChartAggregationMonthlyBtn" class="rounded-lg px-4 py-1.5 text-xs font-bold transition-all duration-200">按月</button>
                                </div>
                            </div>
                            <div class="relative h-[420px] md:h-[520px] mx-4 mb-4 md:mx-5 md:mb-5" id="dailyTotalBarChartContainer">
                                <canvas id="dailyTotalBarChart" class="w-full h-full rounded-xl cursor-pointer"></canvas>

                                <div id="barChartLoading" class="absolute inset-0 bg-white/90 backdrop-blur-md flex items-center justify-center rounded-xl hidden">
                                    <div class="text-center">
                                        <div class="mx-auto mb-4 h-10 w-10 rounded-xl border-4 border-slate-200 border-t-slate-600 animate-spin"></div>
                                        <p class="text-sm font-medium text-slate-600">正在生成柱状图...</p>
                                    </div>
                                </div>

                                <div id="barChartNoDataMessage" class="absolute inset-0 bg-white/90 backdrop-blur-md flex items-center justify-center rounded-xl hidden">
                                    <div class="text-center">
                                        <div class="mx-auto mb-4 flex h-14 w-14 items-center justify-center rounded-xl bg-slate-50 border border-slate-200 text-slate-300">
                                            <i class="fa fa-chart-bar text-2xl"></i>
                                        </div>
                                        <p class="text-sm font-medium text-slate-600">暂无数据显示</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 统计信息区域 -->
                        <div id="unifiedStats" class="dashboard-section overflow-hidden">
                            <!-- 由 app.js 动态生成内容 -->
                            <div class="flex flex-col items-center justify-center py-20 text-slate-400">
                                <div class="mb-4 flex h-16 w-16 items-center justify-center rounded-2xl bg-slate-50 border border-slate-100">
                                    <i class="fa fa-chart-pie text-2xl text-slate-300"></i>
                                </div>
                                <p class="text-sm font-medium">加载数据后自动显示统计分析</p>
                            </div>
                        </div>
                    </div>

                    <!-- 口径说明 (已移除) -->
                </div>
            </div>
        </section>

        <!-- 
            ==================== 第四部分：导出 ====================
            提供数据处理结果的导出功能
            使用白色背景卡片和阴影效果增强视觉体验
        -->
        <section id="exportSection" class="mb-14 section-container section-hidden">
            <div class="relative overflow-hidden rounded-3xl border border-slate-200 bg-white shadow-soft">
                <div class="relative px-6 py-6 md:px-8 md:py-8">
                    <!-- Header -->
                    <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between mb-8">
                        <div class="flex items-center gap-6">
                            <div class="relative flex h-14 w-14 shrink-0 items-center justify-center rounded-2xl bg-indigo-600 text-white shadow-xl shadow-indigo-200">
                                <div class="absolute inset-0 rounded-2xl opacity-30 blur-xl bg-indigo-400"></div>
                                <i class="fa fa-file-export text-xl relative"></i>
                            </div>
                            <div class="pt-1">
                                <h2 class="text-2xl font-black tracking-tight text-slate-900">导出报告</h2>
                                <p class="mt-1 text-slate-500 font-medium">配置导出参数并将分析结果保存为本地文件</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="px-4 py-1.5 rounded-full bg-slate-100 text-slate-600 text-xs font-bold border border-slate-200/60 shadow-sm">
                                <i class="far fa-check-circle mr-1.5 text-indigo-500"></i>准备就绪
                            </span>
                        </div>
                    </div>

                    <!-- Main Content Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
                        
                        <!-- Left Column: Main Export Cards -->
                        <div class="lg:col-span-8">
                            <!-- 两个卡片并排 - 使用items-stretch确保等高 -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-stretch">
                                <!-- Chart Export Card -->
                                <div class="group relative z-10 flex flex-col rounded-xl border border-slate-200/80 bg-white p-5 transition-all duration-300 hover:shadow-medium hover:-translate-y-1 transform-gpu h-full overflow-visible">
                                    <div class="flex items-center gap-3 mb-4 pb-3 border-b border-slate-100">
                                        <div class="flex h-9 w-9 items-center justify-center rounded-lg bg-indigo-50 text-indigo-600 shadow-sm border border-indigo-100">
                                            <i class="fa fa-image text-sm"></i>
                                        </div>
                                        <div>
                                            <h3 class="text-sm font-semibold text-slate-800">图表导出</h3>
                                            <p class="text-xs text-slate-400 mt-0.5">保存可视化分析图表</p>
                                        </div>
                                    </div>
                                    
                                    <div class="space-y-3 flex-1 flex flex-col">
                                        <!-- 图表选择 -->
                                        <div class="flex items-center justify-between p-3 rounded-lg bg-slate-50 border border-slate-200">
                                            <span class="text-sm text-slate-600">选择图表</span>
                                            <div class="flex items-center gap-1 relative">
                                                <select id="exportChartSelect" class="bg-transparent border-none py-0 pr-6 text-sm font-medium text-slate-700 focus:ring-0 cursor-pointer appearance-none text-right" aria-label="选择要导出的图表">
                                                    <option value="loadCurve">24小时负荷曲线</option>
                                                    <option value="dailyBar">日期总用电量对比</option>
                                                    <option value="both">两个图表</option>
                                                </select>
                                                <i class="fa fa-chevron-down text-xs text-slate-400 -ml-5 pointer-events-none"></i>
                                            </div>
                                        </div>
                                        
                                        <div class="flex items-center justify-between p-3 rounded-lg bg-slate-50 border border-slate-200">
                                            <span class="text-sm text-slate-600">图片质量</span>
                                            <div class="flex items-center gap-1 relative">
                                                <select id="pngQuality" class="bg-transparent border-none py-0 pr-6 text-sm font-medium text-slate-700 focus:ring-0 cursor-pointer appearance-none text-right" aria-label="PNG质量">
                                                    <option value="0.7">70%</option>
                                                    <option value="0.8">80%</option>
                                                    <option value="0.9" selected>90%</option>
                                                    <option value="1.0">100%</option>
                                                </select>
                                                <i class="fa fa-chevron-down text-xs text-slate-400 -ml-5 pointer-events-none"></i>
                                            </div>
                                        </div>
                                        
                                        <div class="grid grid-cols-3 gap-2">
                                            <button id="exportPNG" class="group flex flex-col items-center justify-center gap-2 py-3 rounded-lg border border-slate-200 bg-white text-slate-600 hover:border-indigo-200 hover:bg-indigo-50/30 hover:text-indigo-600 hover:-translate-y-0.5 hover:shadow-sm transition-all" title="导出为PNG">
                                                <i class="fa fa-file-image text-xl text-slate-400 group-hover:text-indigo-500 transition-colors"></i>
                                                <span class="text-xs font-medium">PNG</span>
                                            </button>
                                            <button id="exportJPG" class="group flex flex-col items-center justify-center gap-2 py-3 rounded-lg border border-slate-200 bg-white text-slate-600 hover:border-indigo-200 hover:bg-indigo-50/30 hover:text-indigo-600 hover:-translate-y-0.5 hover:shadow-sm transition-all" title="导出为JPG">
                                                <i class="fa fa-file-image text-xl text-slate-400 group-hover:text-indigo-500 transition-colors"></i>
                                                <span class="text-xs font-medium">JPG</span>
                                            </button>
                                            <button id="exportSVG" class="group flex flex-col items-center justify-center gap-2 py-3 rounded-lg border border-slate-200 bg-white text-slate-600 hover:border-indigo-200 hover:bg-indigo-50/30 hover:text-indigo-600 hover:-translate-y-0.5 hover:shadow-sm transition-all" title="导出为SVG">
                                                <i class="fa fa-file-code text-xl text-slate-400 group-hover:text-indigo-500 transition-colors"></i>
                                                <span class="text-xs font-medium">SVG</span>
                                            </button>
                                        </div>

                                        <button id="exportPDF" class="group w-full flex items-center justify-center gap-2 py-3 rounded-lg bg-gradient-to-r from-indigo-600 to-indigo-700 text-white font-bold text-sm hover:from-indigo-700 hover:to-indigo-800 transition-all shadow-md shadow-indigo-100 hover:shadow-lg hover:shadow-indigo-200 hover:-translate-y-0.5" title="生成PDF专业报告">
                                            <i class="fa fa-file-pdf text-sm group-hover:scale-110 transition-transform"></i>
                                            <span>生成 PDF 专业报告</span>
                                        </button>

                                        <div class="rounded-lg bg-slate-50 border border-slate-200 p-3 mt-auto">
                                            <p class="text-xs text-slate-500 leading-relaxed">
                                                <i class="fa fa-info-circle text-slate-400 mr-1"></i>
                                                PDF 报告将包含当前视图下的所有可视化图表与数据摘要
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Data Export Card -->
                                <div class="group relative z-10 flex flex-col rounded-xl border border-slate-200/80 bg-white p-5 transition-all duration-300 hover:shadow-medium hover:-translate-y-1 transform-gpu h-full overflow-visible">
                                    <div class="flex items-center gap-3 mb-4 pb-3 border-b border-slate-100">
                                        <div class="flex h-9 w-9 items-center justify-center rounded-lg bg-indigo-50 text-indigo-600 shadow-sm border border-indigo-100">
                                            <i class="fa fa-table text-sm"></i>
                                        </div>
                                        <div>
                                            <h3 class="text-sm font-semibold text-slate-800">数据导出</h3>
                                            <p class="text-xs text-slate-400 mt-0.5">导出明细与统计表格</p>
                                        </div>
                                    </div>

                                    <div class="space-y-3 flex-1 flex flex-col">
                                        <div class="flex items-center justify-between p-3 rounded-lg bg-slate-50 border border-slate-200">
                                            <span class="text-sm text-slate-600">文件格式</span>
                                            <div class="flex items-center gap-1 relative">
                                                <select id="exportFormat" class="bg-transparent border-none py-0 pr-6 text-sm font-medium text-slate-700 focus:ring-0 cursor-pointer appearance-none text-right" aria-label="导出格式">
                                                    <option value="xlsx">Excel (XLSX)</option>
                                                    <option value="csv">CSV</option>
                                                </select>
                                                <i class="fa fa-chevron-down text-xs text-slate-400 -ml-5 pointer-events-none"></i>
                                            </div>
                                        </div>

                                        <div class="grid grid-cols-2 gap-2">
                                            <button id="exportFullPackage" class="group flex items-center justify-center gap-1.5 py-2.5 rounded-lg bg-indigo-600 text-white font-medium text-xs hover:bg-indigo-700 transition-all shadow-sm shadow-indigo-100 hover:shadow-indigo-200 hover:-translate-y-0.5" title="导出完整数据包">
                                                <i class="fa fa-box-archive text-xs group-hover:scale-110 transition-transform"></i>
                                                <span>完整数据包</span>
                                            </button>
                                            <button id="export15MinData" class="group flex items-center justify-center gap-1.5 py-2.5 rounded-lg bg-indigo-50 text-indigo-600 border border-indigo-100 font-medium text-xs hover:bg-indigo-100 hover:border-indigo-200 transition-all shadow-sm hover:-translate-y-0.5" title="导出15分钟明细数据">
                                                <i class="fa fa-clock text-xs group-hover:scale-110 transition-transform"></i>
                                                <span>15min 明细</span>
                                            </button>
                                        </div>
                                        
                                        <button id="exportPVsystData" class="group w-full flex items-center justify-center gap-2 py-2.5 rounded-lg border border-slate-200 bg-white text-slate-600 font-medium text-xs hover:bg-slate-50 hover:border-slate-300 hover:text-slate-800 transition-all hover:-translate-y-0.5" title="导出PVsyst月度重排数据">
                                            <i class="fas fa-solar-panel text-slate-500 text-xs group-hover:text-indigo-500 transition-colors"></i>
                                            <span>PVsyst 标准格式 (8760h)</span>
                                        </button>

                                        <button id="exportZipBundle" class="group w-full flex items-center justify-center gap-2 py-3 rounded-lg border-2 border-dashed border-slate-200 bg-slate-50/50 text-slate-600 font-bold text-xs hover:bg-white hover:border-indigo-300 hover:text-indigo-600 transition-all hover:shadow-sm" title="打包导出为ZIP">
                                            <i class="fa fa-file-zipper text-slate-400 text-sm group-hover:text-indigo-500 transition-colors"></i>
                                            <span>一键打包导出 (ZIP)</span>
                                        </button>

                                        <!-- 导出提示区域 (简化布局) -->
                                        <div class="rounded-lg bg-slate-50 border border-slate-100 p-3 mt-auto">
                                            <ul class="text-[10px] text-slate-500 space-y-1.5">
                                                <li class="flex items-center gap-1.5">
                                                    <div class="w-1 h-1 rounded-full bg-indigo-400"></div>
                                                    <span>完整包含所有维度表格</span>
                                                </li>
                                                <li class="flex items-center gap-1.5">
                                                    <div class="w-1 h-1 rounded-full bg-indigo-400"></div>
                                                    <span>15min数据转为标准格式</span>
                                                </li>
                                                <li class="flex items-center gap-1.5">
                                                    <div class="w-1 h-1 rounded-full bg-indigo-400"></div>
                                                    <span>ZIP包含图表+所有表格</span>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Right Column: Status & Tips -->
                        <div class="lg:col-span-4 flex flex-col gap-4">
                            <div class="rounded-xl border border-slate-200/80 bg-white p-5 shadow-sm hover:shadow-medium hover:-translate-y-1 transform-gpu transition-all duration-300 flex flex-col h-full">
                                <div class="flex items-center justify-between mb-4 pb-3 border-b border-slate-100">
                                    <h3 class="text-sm font-semibold text-slate-800">导出状态</h3>
                                    <span id="exportStatusPill" class="px-2 py-1 rounded-full bg-slate-100 text-xs font-medium text-slate-500">待机中</span>
                                </div>
                                
                                <div id="exportStatusPanel" class="flex flex-col items-center justify-center py-4 px-4 rounded-lg border border-dashed border-slate-200 bg-slate-50/50 text-center mb-4 flex-1">
                                    <div class="h-12 w-12 mb-3 rounded-xl bg-white border border-slate-200 flex items-center justify-center text-slate-300">
                                        <i class="fa fa-cloud-download-alt text-xl"></i>
                                    </div>
                                    <div id="exportStatusTitle" class="text-sm font-semibold text-slate-700">尚未开始导出</div>
                                    <p id="exportStatusMeta" class="mt-1 text-xs text-slate-400">配置完成后即可导出</p>
                                    
                                    <div class="mt-3 w-full pt-3 border-t border-slate-100 flex items-center justify-between text-xs text-slate-400">
                                        <span>最后活动</span>
                                        <span id="exportStatusTime" class="text-slate-500">—</span>
                                    </div>
                                </div>

                                <div id="exportProgressWrap" class="hidden mb-4">
                                    <div class="flex items-center justify-between text-xs text-slate-500 mb-1">
                                        <span>导出进度</span>
                                        <span id="exportProgressText">0%</span>
                                    </div>
                                    <div class="w-full h-1.5 rounded-full bg-slate-200 overflow-hidden">
                                        <div id="exportProgressBar" class="h-1.5 rounded-full bg-slate-700 transition-all duration-300" style="width: 0%"></div>
                                    </div>
                                </div>
                                
                                <div class="space-y-3">
                                    <div class="flex gap-2.5 items-start p-2 rounded-lg hover:bg-slate-50 transition-colors">
                                        <div class="flex h-5 w-5 shrink-0 items-center justify-center rounded bg-slate-100 text-slate-600 text-xs font-bold ring-1 ring-slate-200">1</div>
                                        <div>
                                            <p class="text-xs text-slate-600 font-medium">无损矢量图</p>
                                            <p class="text-[10px] text-slate-400 mt-0.5">使用 <span class="font-bold text-indigo-600">SVG</span> 格式可获得最佳打印清晰度</p>
                                        </div>
                                    </div>
                                    <div class="flex gap-2.5 items-start p-2 rounded-lg hover:bg-slate-50 transition-colors">
                                        <div class="flex h-5 w-5 shrink-0 items-center justify-center rounded bg-indigo-50 text-indigo-600 text-xs font-bold ring-1 ring-indigo-100">2</div>
                                        <div>
                                            <p class="text-xs text-slate-600 font-medium">PVsyst 标准化</p>
                                            <p class="text-[10px] text-slate-400 mt-0.5">已自动预处理为 <span class="font-bold text-indigo-600">8760h CSV</span> 格式</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Bottom: Advanced Config -->
                        <div class="lg:col-span-12 rounded-xl border border-slate-200/80 bg-white p-6 hover:shadow-medium hover:-translate-y-1 transform-gpu transition-all duration-300">
                            <div class="flex items-center justify-between mb-5 pb-4 border-b border-slate-100">
                                <div class="flex items-center gap-3">
                                    <div class="flex h-9 w-9 items-center justify-center rounded-lg bg-indigo-50 text-indigo-600 shadow-sm border border-indigo-100">
                                        <i class="fa fa-sliders-h text-sm"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-base font-semibold text-slate-800">导出高级配置</h3>
                                        <p class="text-xs text-slate-400 mt-0.5">自定义导出文件的命名与范围</p>
                                    </div>
                                </div>
                                
                                <div class="flex items-center gap-3">
                                    <span class="text-sm text-slate-500">导出全部日期</span>
                                    <label class="relative inline-flex cursor-pointer items-center">
                                        <input type="checkbox" id="exportAllDates" class="peer sr-only" checked>
                                        <div class="h-5 w-9 rounded-full bg-slate-200 transition-all peer-checked:bg-indigo-600 after:absolute after:left-[2px] after:top-[2px] after:h-4 after:w-4 after:rounded-full after:bg-white after:transition-all peer-checked:after:translate-x-4"></div>
                                    </label>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
                                <!-- 左侧：文件名配置 -->
                                <div class="space-y-4 md:col-span-4">
                                    <div>
                                        <label for="exportFileName" class="block text-xs font-medium text-slate-500 mb-2">文件名前缀</label>
                                        <input type="text" id="exportFileName" value="负荷曲线数据" class="w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2.5 text-sm text-slate-700 focus:border-slate-400 focus:bg-white focus:ring-2 focus:ring-slate-100 transition-all" placeholder="请输入前缀...">
                                    </div>

                                    <div>
                                        <label for="exportNameTemplate" class="block text-xs font-medium text-slate-500 mb-2">命名模板（可选）</label>
                                        <input type="text" id="exportNameTemplate" value="" class="w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2.5 text-sm text-slate-700 focus:border-slate-400 focus:bg-white focus:ring-2 focus:ring-slate-100 transition-all" placeholder="例如：{prefix}_{baseName}_{dateRange}.{ext}">
                                        <p class="mt-1.5 text-xs text-slate-400">可用变量：{prefix} {baseName} {dateRange} {exportTime} {ext}</p>
                                    </div>
                                </div>
                                
                                <!-- 中间：命名选项 -->
                                <div class="space-y-3 md:col-span-4">
                                    <label class="block text-xs font-medium text-slate-500 mb-2">命名选项</label>
                                    <div class="space-y-2">
                                        <label class="flex cursor-pointer items-center justify-between px-3 py-2.5 rounded-lg bg-slate-50 border border-slate-200 hover:border-slate-300 hover:bg-white transition-all">
                                            <span class="text-sm text-slate-600">包含导出时间戳</span>
                                            <input type="checkbox" id="includeTimestamp" class="h-4 w-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500" checked>
                                        </label>
                                        <label class="flex cursor-pointer items-center justify-between px-3 py-2.5 rounded-lg bg-slate-50 border border-slate-200 hover:border-slate-300 hover:bg-white transition-all">
                                            <span class="text-sm text-slate-600">包含当前筛选条件</span>
                                            <input type="checkbox" id="includeFiltersInName" class="h-4 w-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500">
                                        </label>
                                        <label class="flex cursor-pointer items-center justify-between px-3 py-2.5 rounded-lg bg-slate-50 border border-slate-200 hover:border-slate-300 hover:bg-white transition-all">
                                            <span class="text-sm text-slate-600">仅导出工作日（周一~周五）</span>
                                            <input type="checkbox" id="exportWeekdaysOnly" class="h-4 w-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500">
                                        </label>
                                        <label class="flex cursor-pointer items-center justify-between px-3 py-2.5 rounded-lg bg-slate-50 border border-slate-200 hover:border-slate-300 hover:bg-white transition-all">
                                            <span class="text-sm text-slate-600">附加异常标注列</span>
                                            <input type="checkbox" id="exportAnomalyMarks" class="h-4 w-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500" checked>
                                        </label>
                                    </div>
                                </div>

                                <!-- 右侧：时间范围和采样间隔 -->
                                <div class="space-y-4 md:col-span-4">
                                    <div>
                                        <label class="block text-xs font-medium text-slate-500 mb-2">导出时间范围</label>
                                        <div class="grid grid-cols-2 gap-3">
                                            <div>
                                                <label class="text-xs text-slate-400 mb-1 block">起始日期</label>
                                                <div class="relative">
                                                    <select id="exportStartDate" class="w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-700 focus:border-slate-400 focus:bg-white transition-all appearance-none cursor-pointer">
                                                        <option value="">开始日期</option>
                                                    </select>
                                                    <i class="fa fa-calendar absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none text-xs"></i>
                                                </div>
                                            </div>
                                            <div>
                                                <label class="text-xs text-slate-400 mb-1 block">结束日期</label>
                                                <div class="relative">
                                                    <select id="exportEndDate" class="w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-700 focus:border-slate-400 focus:bg-white transition-all appearance-none cursor-pointer">
                                                        <option value="">结束日期</option>
                                                    </select>
                                                    <i class="fa fa-calendar absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none text-xs"></i>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="rounded-lg bg-slate-50 border border-slate-200 p-4">
                                        <div class="flex items-center gap-2 mb-3">
                                            <i class="fa fa-clock text-slate-500 text-sm"></i>
                                            <label class="text-xs font-medium text-slate-700">导出采样间隔</label>
                                        </div>
                                        <div class="grid grid-cols-2 gap-3">
                                            <div class="relative">
                                                <select id="exportSamplingInterval" class="w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-700 focus:border-slate-400 focus:bg-white transition-all appearance-none cursor-pointer">
                                                    <option value="auto" selected>自动</option>
                                                    <option value="15">15 分钟</option>
                                                    <option value="30">30 分钟</option>
                                                    <option value="60">60 分钟</option>
                                                </select>
                                                <i class="fa fa-clock absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none text-xs"></i>
                                            </div>
                                            <div class="relative">
                                                <select id="exportSamplingAgg" class="w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-700 focus:border-slate-400 focus:bg-white transition-all appearance-none cursor-pointer">
                                                    <option value="sum" selected>求和</option>
                                                    <option value="avg">平均</option>
                                                </select>
                                                <i class="fa fa-calculator absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none text-xs"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <div id="exportPreviewModal" class="fixed inset-0 z-[100] hidden" aria-hidden="true">
            <div class="absolute inset-0 bg-slate-900/50 backdrop-blur-sm"></div>
            <div class="relative mx-auto max-w-2xl px-4 py-10">
                <div class="rounded-3xl border border-slate-200 bg-white shadow-strong overflow-hidden">
                    <div class="px-6 py-5 border-b border-slate-100 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="h-10 w-10 rounded-2xl bg-indigo-600 text-white flex items-center justify-center shadow-lg shadow-indigo-100">
                                <i class="fa fa-paper-plane text-sm"></i>
                            </div>
                            <div>
                                <div class="text-lg font-black text-slate-900">导出预览</div>
                                <div class="text-xs font-bold text-slate-500">确认导出内容与文件名后开始导出</div>
                            </div>
                        </div>
                        <button id="exportPreviewClose" class="h-10 w-10 rounded-2xl border border-slate-200 bg-white text-slate-500 hover:bg-slate-50 hover:text-slate-700 transition-all" aria-label="关闭导出预览">
                            <i class="fa fa-times"></i>
                        </button>
                    </div>

                    <div class="px-6 py-6 space-y-5">
                        <div class="rounded-2xl border border-slate-200 bg-slate-50/40 p-5">
                            <div class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]">文件名</div>
                            <div id="exportPreviewFileName" class="mt-2 font-black text-slate-900 break-all">—</div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="rounded-2xl border border-slate-200 bg-white p-5">
                                <div class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]">内容</div>
                                <div id="exportPreviewSummary" class="mt-2 text-sm font-bold text-slate-700 leading-relaxed">—</div>
                            </div>
                            <div class="rounded-2xl border border-slate-200 bg-white p-5">
                                <div class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]">范围</div>
                                <div id="exportPreviewRange" class="mt-2 text-sm font-bold text-slate-700 leading-relaxed">—</div>
                            </div>
                        </div>
                        <div id="exportPreviewChartWrap" class="hidden rounded-2xl border border-slate-200 bg-white p-5">
                            <div class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-3">图表缩略图</div>
                            <div class="space-y-4">
                                <div>
                                    <img id="exportPreviewChartImg" class="w-full rounded-2xl border border-slate-100" alt="负荷曲线图预览" />
                                    <div class="text-xs text-slate-500 mt-2 text-center">24小时负荷曲线</div>
                                </div>
                                <div id="exportPreviewBarChartWrap" class="hidden">
                                    <img id="exportPreviewBarChartImg" class="w-full rounded-2xl border border-slate-100" alt="柱状图预览" />
                                    <div class="text-xs text-slate-500 mt-2 text-center">日期总用电量对比</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="px-6 py-5 border-t border-slate-100 flex flex-col md:flex-row gap-3 md:items-center md:justify-end bg-slate-50/40">
                        <button id="exportPreviewCancel" class="px-5 py-3 rounded-2xl border border-slate-200 bg-white text-slate-700 font-black hover:bg-slate-50 transition-all">取消</button>
                        <button id="exportPreviewConfirm" class="px-5 py-3 rounded-2xl bg-indigo-600 text-white font-black hover:bg-indigo-700 transition-all">确认导出</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PDF预览模态框 -->
    <div id="pdfPreviewModal" class="fixed inset-0 z-[110] hidden" aria-hidden="true">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" id="pdfPreviewOverlay"></div>
        <div class="relative h-full flex flex-col">
            <!-- 头部 -->
            <div class="bg-white border-b border-slate-200 px-4 py-3 flex items-center justify-between shadow-sm">
                <div class="flex items-center gap-3">
                    <div class="h-9 w-9 rounded-xl bg-gradient-to-br from-indigo-600 to-indigo-700 text-white flex items-center justify-center shadow-lg">
                        <i class="fa fa-file-pdf text-sm"></i>
                    </div>
                    <div>
                        <div class="text-base font-bold text-slate-900">PDF报告预览</div>
                        <div class="text-xs text-slate-500">确认内容后可直接打印或保存</div>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <button id="pdfPreviewPrint" class="px-4 py-2 rounded-lg bg-indigo-600 text-white text-sm font-semibold hover:bg-indigo-700 transition flex items-center gap-2">
                        <i class="fa fa-print"></i>
                        <span>打印 / 保存PDF</span>
                    </button>
                    <button id="pdfPreviewClose" class="h-9 w-9 rounded-lg border border-slate-200 bg-white text-slate-500 hover:bg-slate-50 hover:text-slate-700 transition flex items-center justify-center">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
            </div>
            <!-- 预览内容区域 -->
            <div class="flex-1 overflow-auto bg-slate-100 p-4">
                <div id="pdfPreviewContent" class="max-w-4xl mx-auto bg-white shadow-lg min-h-[800px]">
                    <!-- PDF内容将在这里动态生成 -->
                    <div class="p-8 text-center text-slate-400">
                        <i class="fa fa-spinner fa-spin text-2xl mb-3"></i>
                        <p>正在生成PDF预览...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- AI配置模态框 -->
    <div id="aiConfigModal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[150] hidden flex items-center justify-center transition-opacity duration-300">
        <div class="bg-white rounded-3xl w-full max-w-md overflow-hidden shadow-2xl border border-slate-200">
            <div class="px-6 py-5 border-b border-slate-100 flex items-center justify-between bg-slate-50/50">
                <div class="flex items-center gap-3">
                    <div class="h-9 w-9 rounded-xl bg-indigo-600 text-white flex items-center justify-center">
                        <i class="fa fa-cog text-sm"></i>
                    </div>
                    <h3 class="text-base font-bold text-slate-800">AI 分析配置</h3>
                </div>
                <button id="closeAiConfig" class="h-8 w-8 rounded-lg text-slate-400 hover:bg-slate-100 hover:text-slate-600 transition-all">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="p-6 space-y-5">
                <div>
                    <label class="block text-[11px] font-bold text-slate-400 uppercase tracking-wider mb-2">API 基础地址</label>
                    <input type="text" id="aiApiBase" class="w-full rounded-xl border border-slate-200 bg-slate-50 px-4 py-2.5 text-sm font-medium focus:border-indigo-500 focus:bg-white focus:ring-4 focus:ring-indigo-500/10 outline-none transition-all" placeholder="https://api.openai.com/v1">
                    <p class="mt-1.5 text-[10px] text-slate-400">留空则使用默认 OpenAI 接口地址</p>
                </div>
                <div>
                    <label class="block text-[11px] font-bold text-slate-400 uppercase tracking-wider mb-2">API Key</label>
                    <div class="relative">
                        <input type="password" id="aiApiKey" class="w-full rounded-xl border border-slate-200 bg-slate-50 pl-4 pr-10 py-2.5 text-sm font-medium focus:border-indigo-500 focus:bg-white focus:ring-4 focus:ring-indigo-500/10 outline-none transition-all" placeholder="sk-...">
                        <button type="button" id="toggleAiKeyVisible" class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600">
                            <i class="fa fa-eye text-xs"></i>
                        </button>
                    </div>
                </div>
                <div>
                    <label class="block text-[11px] font-bold text-slate-400 uppercase tracking-wider mb-2">模型名称</label>
                    <input type="text" id="aiApiModel" class="w-full rounded-xl border border-slate-200 bg-slate-50 px-4 py-2.5 text-sm font-medium focus:border-indigo-500 focus:bg-white focus:ring-4 focus:ring-indigo-500/10 outline-none transition-all" placeholder="gpt-3.5-turbo">
                </div>
                <div class="rounded-2xl bg-amber-50 border border-amber-100 p-4 flex gap-3">
                    <i class="fa fa-info-circle text-amber-500 mt-0.5"></i>
                    <p class="text-[11px] text-amber-700 leading-relaxed font-medium">
                        配置将仅存储在您的本地浏览器（LocalStorage）中。建议使用支持跨域请求的 API 中转或本地代理。
                    </p>
                </div>

                <!-- 厂商配置指南 -->
                <div class="mt-4 border-t border-slate-100 pt-4">
                    <button id="toggleConfigGuide" class="flex items-center justify-between w-full text-[11px] font-bold text-slate-400 hover:text-indigo-600 transition-colors group">
                        <span class="flex items-center gap-2">
                            <i class="fa fa-book-open text-[10px]"></i>
                            常用厂商配置指南
                        </span>
                        <i class="fa fa-chevron-down transition-transform duration-300" id="guideArrow"></i>
                    </button>
                    <div id="configGuideContent" class="hidden mt-3 space-y-3 max-h-[180px] overflow-y-auto pr-2 custom-scrollbar animate-in fade-in slide-in-from-top-2">
                        <!-- DeepSeek -->
                        <div class="p-3 rounded-xl bg-slate-50 border border-slate-100 hover:border-indigo-200 transition-colors">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-[11px] font-extrabold text-slate-700">DeepSeek (深度求索)</span>
                                <span class="px-1.5 py-0.5 rounded-md bg-indigo-100 text-indigo-600 text-[9px] font-black uppercase">推荐</span>
                            </div>
                            <div class="text-[10px] text-slate-500 space-y-1.5">
                                <div class="flex items-center justify-between">
                                    <span>接口地址:</span>
                                    <code class="bg-white px-1.5 py-0.5 rounded border border-slate-200 text-slate-800">https://api.deepseek.com</code>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span>常用模型:</span>
                                    <code class="bg-white px-1.5 py-0.5 rounded border border-slate-200 text-slate-800">deepseek-chat</code>
                                </div>
                            </div>
                        </div>
                        <!-- Moonshot -->
                        <div class="p-3 rounded-xl bg-slate-50 border border-slate-100 hover:border-indigo-200 transition-colors">
                            <span class="text-[11px] font-extrabold text-slate-700 block mb-2">Moonshot (Kimi)</span>
                            <div class="text-[10px] text-slate-500 space-y-1.5">
                                <div class="flex items-center justify-between">
                                    <span>接口地址:</span>
                                    <code class="bg-white px-1.5 py-0.5 rounded border border-slate-200 text-slate-800">https://api.moonshot.cn/v1</code>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span>常用模型:</span>
                                    <code class="bg-white px-1.5 py-0.5 rounded border border-slate-200 text-slate-800">moonshot-v1-8k</code>
                                </div>
                            </div>
                        </div>
                        <!-- Zhipu AI -->
                        <div class="p-3 rounded-xl bg-slate-50 border border-slate-100 hover:border-indigo-200 transition-colors">
                            <span class="text-[11px] font-extrabold text-slate-700 block mb-2">智谱 AI (GLM)</span>
                            <div class="text-[10px] text-slate-500 space-y-1.5">
                                <div class="flex items-center justify-between">
                                    <span>接口地址:</span>
                                    <code class="bg-white px-1.5 py-0.5 rounded border border-slate-200 text-slate-800">https://open.bigmodel.cn/api/paas/v4/</code>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span>常用模型:</span>
                                    <code class="bg-white px-1.5 py-0.5 rounded border border-slate-200 text-slate-800">glm-4-flash</code>
                                </div>
                            </div>
                        </div>
                        <!-- SiliconFlow -->
                        <div class="p-3 rounded-xl bg-slate-50 border border-slate-100 hover:border-indigo-200 transition-colors">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-[11px] font-extrabold text-slate-700">SiliconFlow (硅基流动)</span>
                                <span class="px-1.5 py-0.5 rounded-md bg-emerald-100 text-emerald-600 text-[9px] font-black uppercase">聚合</span>
                            </div>
                            <div class="text-[10px] text-slate-500 space-y-1.5">
                                <div class="flex items-center justify-between">
                                    <span>接口地址:</span>
                                    <code class="bg-white px-1.5 py-0.5 rounded border border-slate-200 text-slate-800">https://api.siliconflow.cn/v1</code>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span>常用模型:</span>
                                    <code class="bg-white px-1.5 py-0.5 rounded border border-slate-200 text-slate-800">deepseek-ai/DeepSeek-V3</code>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="px-6 py-4 bg-slate-50 border-t border-slate-100 flex justify-end gap-3">
                <button id="cancelAiConfig" class="px-5 py-2 rounded-xl text-sm font-bold text-slate-600 hover:bg-slate-200 transition-all">取消</button>
                <button id="saveAiConfig" class="px-6 py-2 rounded-xl bg-indigo-600 text-white text-sm font-bold hover:bg-indigo-700 transition-all shadow-md shadow-indigo-100">保存配置</button>
            </div>
        </div>
    </div>
    </main>

    <!-- 作者信息 -->
    <footer class="bg-white border-t border-slate-200 mt-12 py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <div class="mb-8">
                    <h3 class="text-xl font-black text-slate-900 mb-4 tracking-tight">关于本工具</h3>
                    <div class="flex flex-col items-center gap-2">
                        <p class="text-slate-600 text-sm font-medium">
                            <i class="fa fa-user mr-2 text-indigo-500"></i>
                            作者：<span class="text-slate-900 font-bold">冯伟明</span>
                        </p>
                        <p class="text-slate-600 text-sm font-medium">
                            <i class="fa fa-weixin mr-2 text-indigo-500"></i>
                            微信联系方式：<span class="text-slate-900 font-bold">Call13345934750</span>
                        </p>
                        <p class="text-slate-600 text-sm font-medium">
                            <i class="fa fa-comments mr-2 text-indigo-500"></i>
                            公众号：<span class="text-slate-900 font-bold">能源小鲨鱼</span>
                        </p>
                    </div>
                </div>
                
                <div class="bg-indigo-50/50 border border-indigo-100 p-4 rounded-2xl max-w-md mx-auto mb-8 shadow-sm">
                    <div class="flex items-center gap-3">
                        <div class="flex h-8 w-8 shrink-0 items-center justify-center rounded-full bg-indigo-100 text-indigo-600">
                            <i class="fa fa-info-circle text-xs"></i>
                        </div>
                        <p class="text-sm text-indigo-800 text-left font-medium leading-relaxed">
                            <strong>重要提醒：</strong>该版本为初始版本，可能存在尚未发现的性能或计算差异，如有问题请及时反馈。
                        </p>
                    </div>
                </div>
                
                <div class="text-sm font-bold text-slate-400">
                    <p>© 2026 负荷曲线分析工具 · 专为电力数据分析设计</p>
                </div>
            </div>
        </div>
    </footer>
    </div> <!-- Close flex-1 -->
    </div> <!-- Close centered wrapper -->
    </div> <!-- Close Layout Wrapper -->

    <!-- 通知组件 -->
    <div id="notification" class="fixed bottom-6 right-6 px-6 py-4 rounded-2xl border border-white/40 bg-white shadow-2xl transform translate-y-20 opacity-0 scale-95 transition-all duration-500 flex items-center max-w-sm hidden z-[100] ring-1 ring-slate-200/50">
        <div id="notificationIconContainer" class="mr-4 flex h-10 w-10 items-center justify-center rounded-xl bg-slate-50 shadow-inner">
            <i id="notificationIcon" class="text-lg"></i>
        </div>
        <div class="flex-1">
            <h3 id="notificationTitle" class="text-sm font-black text-slate-900 tracking-tight"></h3>
            <p id="notificationMessage" class="text-xs font-medium text-slate-500 mt-0.5 leading-relaxed"></p>
        </div>
        <button id="closeNotification" class="ml-4 flex h-8 w-8 items-center justify-center rounded-full text-slate-400 hover:bg-slate-100 hover:text-slate-600 transition-all" aria-label="关闭通知" title="关闭通知">
            <i class="fa fa-times text-xs"></i>
        </button>
    </div>

    <!-- 模态框 -->
    <div id="modalOverlay" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[90] hidden flex items-center justify-center transition-opacity duration-300">
        <div id="modal" class="bg-white rounded-3xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col transform transition-all duration-300 scale-95 opacity-0 shadow-2xl border border-slate-100">
            <div class="px-6 py-5 border-b border-slate-100 flex justify-between items-center bg-slate-50/50 shrink-0">
                <h3 id="modalTitle" class="text-xl font-extrabold text-slate-900 tracking-tight"></h3>
                <button id="closeModal" class="flex h-9 w-9 items-center justify-center rounded-full text-slate-400 hover:bg-slate-200 hover:text-slate-700 transition-all" aria-label="关闭模态框" title="关闭模态框">
                    <i class="fa fa-times text-lg"></i>
                </button>
            </div>
            <div id="modalContent" class="p-6 md:p-8 overflow-y-auto">
                <!-- 模态框内容将通过JS填充 -->
            </div>
        </div>
    </div>

    <!-- 曲线样式设置模态框 -->
    <div id="curveStyleModal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[90] hidden flex items-center justify-center transition-opacity duration-300">
        <div class="bg-white rounded-3xl w-full max-w-md transform transition-all duration-300 scale-95 opacity-0 shadow-2xl border border-slate-100 overflow-hidden">
            <div class="px-6 py-5 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                <div class="flex items-center gap-3">
                    <div class="flex h-10 w-10 items-center justify-center rounded-xl bg-indigo-100 text-indigo-600">
                        <i class="fa fa-palette"></i>
                    </div>
                    <h3 class="text-xl font-extrabold text-slate-900 tracking-tight">曲线样式设置</h3>
                </div>
                <button id="closeCurveStyleModal" class="flex h-9 w-9 items-center justify-center rounded-full text-slate-400 hover:bg-slate-200 hover:text-slate-700 transition-all" aria-label="关闭样式设置" title="关闭样式设置">
                    <i class="fa fa-times text-lg"></i>
                </button>
            </div>
            <div class="p-6 md:p-8 space-y-6">
                <!-- 线条设置 -->
                <div class="space-y-4">
                    <h4 class="text-xs font-black uppercase tracking-wider text-slate-400 flex items-center gap-2">
                        <i class="fa fa- signature"></i> 基础样式
                    </h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <label class="text-sm font-bold text-slate-700">线条线型</label>
                            <select id="lineStyle" class="w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2.5 text-sm font-bold text-slate-700 outline-none transition-all focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10">
                                <option value="solid">实线 (Solid)</option>
                                <option value="dashed">虚线 (Dashed)</option>
                                <option value="dotted">点线 (Dotted)</option>
                            </select>
                        </div>
                        <div class="space-y-2">
                            <label class="text-sm font-bold text-slate-700">数据点显示</label>
                            <select id="showPoints" class="w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2.5 text-sm font-bold text-slate-700 outline-none transition-all focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10">
                                <option value="true">显示数据点</option>
                                <option value="false">隐藏数据点</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 平滑设置 -->
                <div class="space-y-4 pt-4 border-t border-slate-100">
                    <h4 class="text-xs font-black uppercase tracking-wider text-slate-400 flex items-center gap-2">
                        <i class="fa fa-wave-square"></i> 曲线平滑
                    </h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <label class="text-sm font-bold text-slate-700">平滑开关</label>
                            <select id="smoothCurve" class="w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2.5 text-sm font-bold text-slate-700 outline-none transition-all focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10">
                                <option value="false">关闭平滑</option>
                                <option value="true" selected>开启平滑</option>
                            </select>
                        </div>
                        <div class="space-y-2">
                            <label class="text-sm font-bold text-slate-700">平滑度 (Tension)</label>
                            <select id="curveTension" class="w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2.5 text-sm font-bold text-slate-700 outline-none transition-all focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10">
                                <option value="0.1">低 (0.1)</option>
                                <option value="0.2">中 (0.2)</option>
                                <option value="0.4" selected>高 (0.4)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 坐标轴设置 -->
                <div class="space-y-4 pt-4 border-t border-slate-100">
                    <h4 class="text-xs font-black uppercase tracking-wider text-slate-400 flex items-center gap-2">
                        <i class="fa fa-arrows-left-right"></i> 坐标轴设置
                    </h4>
                    <label class="flex cursor-pointer items-center justify-between rounded-2xl border border-slate-200 bg-slate-50 p-4 hover:border-indigo-200 hover:bg-indigo-50/30 transition-all">
                        <div class="flex items-center gap-3">
                            <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-white shadow-sm text-indigo-600 border border-slate-100">
                                <i class="fa fa-chart-line text-xs"></i>
                            </div>
                            <div>
                                <span class="block text-sm font-bold text-slate-700">启用辅助Y轴</span>
                                <span class="block text-xs text-slate-500">在右侧显示电量 (kW) 刻度</span>
                            </div>
                        </div>
                        <input type="checkbox" id="secondaryAxis" class="h-5 w-5 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500 transition-all">
                    </label>
                </div>

                <!-- 确定按钮 -->
                <div class="pt-4">
                    <button id="applyCurveStyle" class="w-full rounded-2xl bg-indigo-600 py-3 text-sm font-black text-white shadow-xl shadow-indigo-100 hover:bg-indigo-700 transition-all active:scale-[0.98]">
                        完成设置
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 第一个小时计算过程预览模态框 -->
    <div id="firstHourCalculationModal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[90] hidden flex items-center justify-center transition-opacity duration-300">
        <div class="bg-white rounded-3xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col transform transition-all duration-300 scale-95 opacity-0 shadow-2xl border border-slate-100">
            <div class="px-6 py-5 border-b border-slate-100 flex justify-between items-center bg-slate-50/50 shrink-0">
                <div class="flex items-center gap-3">
                    <div class="flex h-10 w-10 items-center justify-center rounded-xl bg-indigo-100 text-indigo-600">
                        <i class="fa fa-calculator"></i>
                    </div>
                    <h3 class="text-xl font-extrabold text-slate-900 tracking-tight">第一个小时计算过程预览</h3>
                </div>
                <button id="closeFirstHourCalculationModal" class="flex h-9 w-9 items-center justify-center rounded-full text-slate-400 hover:bg-slate-200 hover:text-slate-700 transition-all" aria-label="关闭第一个小时计算预览" title="关闭第一个小时计算预览">
                    <i class="fa fa-times text-lg"></i>
                </button>
            </div>
            <div class="p-6 md:p-8 space-y-8 overflow-y-auto">
                <div>
                    <h4 class="flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 mb-4">
                        <i class="fa fa-info-circle"></i> 基本信息
                    </h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
                            <span class="block text-xs font-semibold text-slate-500 mb-1">日期</span>
                            <span id="previewDate" class="block font-bold text-slate-900">-</span>
                        </div>
                        <div class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
                            <span class="block text-xs font-semibold text-slate-500 mb-1">时间间隔</span>
                            <span id="previewInterval" class="block font-bold text-slate-900">-</span>
                        </div>
                        <div class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
                            <span class="block text-xs font-semibold text-slate-500 mb-1">数据类型</span>
                            <span id="previewDataType" class="block font-bold text-slate-900">-</span>
                        </div>
                        <div class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
                            <span class="block text-xs font-semibold text-slate-500 mb-1">倍率</span>
                            <span id="previewMultiplier" class="block font-bold text-slate-900">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 mb-3">
                            <i class="fa fa-database"></i> 原始数据（首小时）
                        </h4>
                        <div class="border border-slate-200 rounded-2xl p-4 bg-slate-50 max-h-48 overflow-y-auto custom-scrollbar">
                            <pre id="previewRawData" class="text-xs font-mono text-slate-600 whitespace-pre-wrap leading-relaxed">-</pre>
                        </div>
                    </div>
                    <div>
                        <h4 class="flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 mb-3">
                            <i class="fa fa-filter"></i> 清洗后数据
                        </h4>
                        <div class="border border-slate-200 rounded-2xl p-4 bg-slate-50 max-h-48 overflow-y-auto custom-scrollbar">
                            <pre id="previewCleanedData" class="text-xs font-mono text-slate-600 whitespace-pre-wrap leading-relaxed">-</pre>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h4 class="flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 mb-3">
                        <i class="fa fa-code-branch"></i> 计算过程
                    </h4>
                    <div class="border border-slate-200 rounded-2xl p-5 bg-white shadow-sm">
                        <div id="previewCalculationProcess" class="text-sm text-slate-700 leading-relaxed font-mono">-</div>
                    </div>
                </div>
                
                <div>
                    <h4 class="flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 mb-3">
                        <i class="fa fa-equals"></i> 计算结果
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="rounded-2xl border border-indigo-100 bg-indigo-50/50 p-5">
                            <div class="text-xs font-bold text-indigo-500 uppercase tracking-wide mb-1">首小时电能值</div>
                            <div id="previewResult" class="text-2xl font-black text-indigo-700">-</div>
                        </div>
                        <div class="rounded-2xl border border-slate-100 bg-slate-50/50 p-5">
                            <div class="text-xs font-bold text-indigo-500 uppercase tracking-wide mb-1">计算公式</div>
                            <div id="previewFormula" class="text-sm font-bold text-slate-700 break-all font-mono">-</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 第一天计算过程预览模态框 -->
    <div id="firstDayCalculationModal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[90] hidden flex items-center justify-center transition-opacity duration-300">
        <div class="bg-white rounded-3xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col transform transition-all duration-300 scale-95 opacity-0 shadow-2xl border border-slate-100">
            <div class="px-6 py-5 border-b border-slate-100 flex justify-between items-center bg-slate-50/50 shrink-0">
                <div class="flex items-center gap-3">
                    <div class="flex h-10 w-10 items-center justify-center rounded-xl bg-indigo-100 text-indigo-600">
                        <i class="fa fa-calendar-day"></i>
                    </div>
                    <h3 class="text-xl font-extrabold text-slate-900 tracking-tight">首日计算逻辑详解</h3>
                </div>
                <button id="closeFirstDayCalculationModal" class="flex h-9 w-9 items-center justify-center rounded-full text-slate-400 hover:bg-slate-200 hover:text-slate-700 transition-all" aria-label="关闭第一天计算预览" title="关闭第一天计算预览">
                    <i class="fa fa-times text-lg"></i>
                </button>
            </div>
            <div class="p-6 md:p-8 space-y-8 overflow-y-auto">
                <div>
                    <h4 class="flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 mb-4">
                        <i class="fa fa-info-circle"></i> 基本信息
                    </h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
                            <span class="block text-xs font-semibold text-slate-500 mb-1">日期</span>
                            <span id="previewFirstDayDate" class="block font-bold text-slate-900">-</span>
                        </div>
                        <div class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
                            <span class="block text-xs font-semibold text-slate-500 mb-1">时间间隔</span>
                            <span id="previewFirstDayInterval" class="block font-bold text-slate-900">-</span>
                        </div>
                        <div class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
                            <span class="block text-xs font-semibold text-slate-500 mb-1">数据类型</span>
                            <span id="previewFirstDayDataType" class="block font-bold text-slate-900">-</span>
                        </div>
                        <div class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
                            <span class="block text-xs font-semibold text-slate-500 mb-1">倍率</span>
                            <span id="previewFirstDayMultiplier" class="block font-bold text-slate-900">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 mb-3">
                            <i class="fa fa-database"></i> 原始数据（首日）
                        </h4>
                        <div class="border border-slate-200 rounded-2xl p-4 bg-slate-50 max-h-48 overflow-y-auto custom-scrollbar">
                            <pre id="previewFirstDayRawData" class="text-xs font-mono text-slate-600 whitespace-pre-wrap leading-relaxed">-</pre>
                        </div>
                    </div>
                    <div>
                        <h4 class="flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 mb-3">
                            <i class="fa fa-filter"></i> 清洗后数据
                        </h4>
                        <div class="border border-slate-200 rounded-2xl p-4 bg-slate-50 max-h-48 overflow-y-auto custom-scrollbar">
                            <pre id="previewFirstDayCleanedData" class="text-xs font-mono text-slate-600 whitespace-pre-wrap leading-relaxed">-</pre>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h4 class="flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 mb-3">
                        <i class="fa fa-code-branch"></i> 计算过程
                    </h4>
                    <div class="border border-slate-200 rounded-2xl p-5 bg-white shadow-sm">
                        <div id="previewFirstDayCalculationProcess" class="text-sm text-slate-700 leading-relaxed font-mono">-</div>
                    </div>
                </div>
                
                <div>
                    <h4 class="flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 mb-3">
                        <i class="fa fa-equals"></i> 计算结果
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="rounded-2xl border border-indigo-100 bg-indigo-50/50 p-5">
                            <div class="text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">首日总电能值</div>
                            <div id="previewFirstDayResult" class="text-2xl font-black text-indigo-700">-</div>
                        </div>
                        <div class="rounded-2xl border border-slate-100 bg-slate-50/50 p-5">
                            <div class="text-xs font-bold text-indigo-500 uppercase tracking-wide mb-1">计算公式</div>
                            <div id="previewFirstDayFormula" class="text-sm font-bold text-slate-700 break-all font-mono">-</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 时段统计对比表格 - 现代化Dashboard风格 -->
    <div id="timeSlotComparisonWindow" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[80] flex items-center justify-center transition-opacity duration-300">
        <div class="bg-white rounded-2xl shadow-2xl border border-slate-100 w-full max-w-4xl mx-4 md:mx-auto max-h-[90vh] flex flex-col transform transition-all duration-300">
            <!-- 标题栏 -->
            <div class="px-6 py-5 border-b border-slate-100 rounded-t-2xl flex justify-between items-center bg-slate-50/50 flex-shrink-0">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600">
                        <i class="fa fa-chart-bar text-lg"></i>
                    </div>
                    <h3 class="text-xl font-extrabold text-slate-900 tracking-tight">时段统计对比</h3>
                </div>
                <button id="closeTimeSlotComparison" class="flex h-9 w-9 items-center justify-center rounded-full text-slate-400 hover:bg-slate-200 hover:text-slate-700 transition-all" title="关闭" aria-label="关闭时间段比较">
                    <i class="fa fa-times text-lg"></i>
                </button>
            </div>
            
            <!-- 内容区域 -->
            <div id="timeSlotComparisonContent" class="p-6 md:p-8 overflow-y-auto custom-scrollbar">
                <!-- 时段选择 -->
                <div class="mb-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="relative group">
                        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 ml-1">开始时段</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-slate-400">
                                <i class="fa fa-clock"></i>
                            </div>
                            <select id="timeSlotStart" class="w-full border border-slate-200 rounded-xl pl-10 pr-4 py-3 text-sm font-medium text-slate-700 bg-slate-50 focus:bg-white focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all outline-none appearance-none" aria-label="开始时段">
                                <option value="0">00:00</option>
                                <option value="1">01:00</option>
                                <option value="2">02:00</option>
                                <option value="3">03:00</option>
                                <option value="4">04:00</option>
                                <option value="5">05:00</option>
                                <option value="6">06:00</option>
                                <option value="7">07:00</option>
                                <option value="8">08:00</option>
                                <option value="9">09:00</option>
                                <option value="10">10:00</option>
                                <option value="11">11:00</option>
                                <option value="12">12:00</option>
                                <option value="13">13:00</option>
                                <option value="14">14:00</option>
                                <option value="15">15:00</option>
                                <option value="16">16:00</option>
                                <option value="17">17:00</option>
                                <option value="18">18:00</option>
                                <option value="19">19:00</option>
                                <option value="20">20:00</option>
                                <option value="21">21:00</option>
                                <option value="22">22:00</option>
                                <option value="23">23:00</option>
                            </select>
                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-slate-400">
                                <i class="fa fa-chevron-down text-xs"></i>
                            </div>
                        </div>
                    </div>
                    <div class="relative group">
                        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 ml-1">结束时段</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-slate-400">
                                <i class="fa fa-clock"></i>
                            </div>
                            <select id="timeSlotEnd" class="w-full border border-slate-200 rounded-xl pl-10 pr-4 py-3 text-sm font-medium text-slate-700 bg-slate-50 focus:bg-white focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all outline-none appearance-none" aria-label="结束时段">
                                <option value="0">00:00</option>
                                <option value="1">01:00</option>
                                <option value="2">02:00</option>
                                <option value="3">03:00</option>
                                <option value="4">04:00</option>
                                <option value="5">05:00</option>
                                <option value="6">06:00</option>
                                <option value="7">07:00</option>
                                <option value="8">08:00</option>
                                <option value="9">09:00</option>
                                <option value="10">10:00</option>
                                <option value="11">11:00</option>
                                <option value="12">12:00</option>
                                <option value="13">13:00</option>
                                <option value="14">14:00</option>
                                <option value="15">15:00</option>
                                <option value="16">16:00</option>
                                <option value="17">17:00</option>
                                <option value="18">18:00</option>
                                <option value="19">19:00</option>
                                <option value="20">20:00</option>
                                <option value="21">21:00</option>
                                <option value="22">22:00</option>
                                <option value="23" selected>23:00</option>
                            </select>
                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-slate-400">
                                <i class="fa fa-chevron-down text-xs"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 统计表格 -->
                <div class="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden mb-8">
                    <div class="max-h-80 overflow-y-auto custom-scrollbar">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="bg-slate-50 border-b border-slate-200">
                                    <th class="py-4 px-6 text-xs font-bold text-slate-500 uppercase tracking-wider">日期</th>
                                    <th class="py-4 px-6 text-xs font-bold text-slate-500 uppercase tracking-wider text-right">时段用电量 (kWh)</th>
                                    <th class="py-4 px-6 text-xs font-bold text-slate-500 uppercase tracking-wider text-right">全天百分比</th>
                                    <th class="py-4 px-6 text-xs font-bold text-slate-500 uppercase tracking-wider text-center">对比</th>
                                </tr>
                            </thead>
                            <tbody id="timeSlotComparisonTableBody" class="divide-y divide-slate-100">
                                <!-- 数据将通过JavaScript动态填充 -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 统计汇总 -->
                <div id="timeSlotSummary" class="p-6 bg-slate-50/80 border border-slate-200 rounded-2xl relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-5">
                        <i class="fa fa-chart-pie text-9xl text-slate-900"></i>
                    </div>
                    <h4 class="flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500 mb-5 relative z-10">
                        <i class="fa fa-calculator"></i> 时段统计汇总
                    </h4>
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 relative z-10">
                        <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition-shadow group">
                            <div class="text-xs font-bold text-indigo-500 uppercase tracking-wide mb-1 group-hover:text-indigo-600">平均用电量</div>
                            <div id="timeSlotAvg" class="text-2xl font-black text-slate-800 tracking-tight">-</div>
                        </div>
                        <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition-shadow group">
                            <div class="text-xs font-bold text-indigo-500 uppercase tracking-wide mb-1 group-hover:text-indigo-600">最大用电量</div>
                            <div id="timeSlotMax" class="text-2xl font-black text-slate-800 tracking-tight">-</div>
                        </div>
                        <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition-shadow group">
                            <div class="text-xs font-bold text-slate-500 uppercase tracking-wide mb-1 group-hover:text-slate-600">最小用电量</div>
                            <div id="timeSlotMin" class="text-2xl font-black text-slate-800 tracking-tight">-</div>
                        </div>
                        <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition-shadow group">
                            <div class="text-xs font-bold text-indigo-500 uppercase tracking-wide mb-1 group-hover:text-indigo-600">总用电量</div>
                            <div id="timeSlotTotal" class="text-2xl font-black text-slate-800 tracking-tight">-</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 返回顶部按钮 -->
    <button id="backToTop" title="返回顶部">
        <i class="fas fa-arrow-up"></i>
    </button>

    <script src="js/app.js"></script>
    
    <!-- 使用说明面板交互 -->
    <script src="js/ui-help.js"></script>
    
    <!-- 原始数据与PVsyst数据对比预览功能 -->
    <script src="js/ui-preview.js"></script>

    <script>
        // 返回顶部逻辑 - 优化版，带滚动进度
        const backToTopBtn = document.getElementById('backToTop');
        let scrollThrottle = false;
        
        window.addEventListener('scroll', () => {
            if (scrollThrottle) return;
            scrollThrottle = true;
            requestAnimationFrame(() => {
                const scrollTop = window.scrollY;
                const docHeight = document.documentElement.scrollHeight - window.innerHeight;
                const scrollPercent = docHeight > 0 ? (scrollTop / docHeight) * 100 : 0;
                
                // 更新滚动进度环
                backToTopBtn.style.setProperty('--scroll-progress', scrollPercent + '%');
                
                // 显示/隐藏按钮
                if (scrollTop > 200) {
                    backToTopBtn.classList.add('show');
                } else {
                    backToTopBtn.classList.remove('show');
                }
                scrollThrottle = false;
            });
        }, { passive: true });
        
        backToTopBtn.addEventListener('click', () => {
            // 添加点击动画
            backToTopBtn.style.transform = 'scale(0.9)';
            setTimeout(() => {
                backToTopBtn.style.transform = '';
            }, 150);
            
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
        
        // AI分析功能 - 接入真实数据与API
        const aiAnalyzeBtn = document.getElementById('aiAnalyzeBtn');
        const aiAnalysisPanel = document.getElementById('aiAnalysisPanel');
        const closeAiPanel = document.getElementById('closeAiPanel');
        const aiAnalysisContent = document.getElementById('aiAnalysisContent');
        const runAiAnalysisBtn = document.getElementById('runAiAnalysisBtn');
        const openAiSettings = document.getElementById('openAiSettings');
        const aiConfigModal = document.getElementById('aiConfigModal');
        const closeAiConfig = document.getElementById('closeAiConfig');
        const cancelAiConfig = document.getElementById('cancelAiConfig');
        const saveAiConfig = document.getElementById('saveAiConfig');
        const toggleAiKeyVisible = document.getElementById('toggleAiKeyVisible');

        // API 配置相关变量
        const API_CONFIG_KEY = 'load_data_ai_config';
        let aiConfig = JSON.parse(localStorage.getItem(API_CONFIG_KEY) || '{"apiBase":"","apiKey":"","model":""}');

        // 初始化配置输入框
        function initConfigInputs() {
            document.getElementById('aiApiBase').value = aiConfig.apiBase || '';
            document.getElementById('aiApiKey').value = aiConfig.apiKey || '';
            document.getElementById('aiApiModel').value = aiConfig.model || 'gpt-3.5-turbo';
        }

        // 切换面板显示
        if (aiAnalyzeBtn) {
            aiAnalyzeBtn.addEventListener('click', () => {
                aiAnalysisPanel.classList.toggle('hidden');
            });
        }

        if (closeAiPanel) {
            closeAiPanel.addEventListener('click', () => {
                aiAnalysisPanel.classList.add('hidden');
            });
        }

        // 配置弹窗交互
        if (openAiSettings) {
            openAiSettings.addEventListener('click', () => {
                initConfigInputs();
                aiConfigModal.classList.remove('hidden');
                setTimeout(() => aiConfigModal.classList.add('opacity-100'), 10);
            });
        }

        const hideConfigModal = () => {
            aiConfigModal.classList.remove('opacity-100');
            setTimeout(() => aiConfigModal.classList.add('hidden'), 300);
        };

        if (closeAiConfig) closeAiConfig.addEventListener('click', hideConfigModal);
        if (cancelAiConfig) cancelAiConfig.addEventListener('click', hideConfigModal);

        if (saveAiConfig) {
            saveAiConfig.addEventListener('click', () => {
                aiConfig = {
                    apiBase: document.getElementById('aiApiBase').value.trim(),
                    apiKey: document.getElementById('aiApiKey').value.trim(),
                    model: document.getElementById('aiApiModel').value.trim() || 'gpt-3.5-turbo'
                };
                localStorage.setItem(API_CONFIG_KEY, JSON.stringify(aiConfig));
                
                // 显示保存成功提示
                const originalText = saveAiConfig.innerText;
                saveAiConfig.innerText = '已保存';
                saveAiConfig.classList.replace('bg-indigo-600', 'bg-emerald-500');
                
                setTimeout(() => {
                    saveAiConfig.innerText = originalText;
                    saveAiConfig.classList.replace('bg-emerald-500', 'bg-indigo-600');
                    hideConfigModal();
                }, 1000);
            });
        }

        if (toggleAiKeyVisible) {
            const toggleConfigGuide = document.getElementById('toggleConfigGuide');
            const configGuideContent = document.getElementById('configGuideContent');
            const guideArrow = document.getElementById('guideArrow');

            if (toggleConfigGuide) {
                toggleConfigGuide.addEventListener('click', () => {
                    const isHidden = configGuideContent.classList.contains('hidden');
                    configGuideContent.classList.toggle('hidden');
                    guideArrow.style.transform = isHidden ? 'rotate(180deg)' : 'rotate(0deg)';
                });
            }

            toggleAiKeyVisible.addEventListener('click', () => {
                const input = document.getElementById('aiApiKey');
                const icon = toggleAiKeyVisible.querySelector('i');
                if (input.type === 'password') {
                    input.type = 'text';
                    icon.classList.replace('fa-eye', 'fa-eye-slash');
                } else {
                    input.type = 'password';
                    icon.classList.replace('fa-eye-slash', 'fa-eye');
                }
            });
        }

        // 从页面获取真实数据进行分析
        function getRealDataForAnalysis() {
            // 优先尝试从全局 appData 获取数据（如果可用）
            if (typeof appData !== 'undefined' && appData.processedData && appData.processedData.length > 0) {
                try {
                    const data = appData.processedData;
                    
                    // 1. 计算月度用电量 (12个月)
                    const monthlyEnergy = new Array(12).fill(0);
                    const monthlyDays = new Array(12).fill(0);
                    data.forEach(d => {
                        const m = new Date(d.date).getMonth();
                        let dailyTotal = 0;
                        for (let h = 0; h < 24; h++) {
                            const v = d.hourlyData?.[h];
                            if (v != null) dailyTotal += v;
                        }
                        monthlyEnergy[m] += dailyTotal;
                        monthlyDays[m]++;
                    });

                    // 2. 计算季度用电量 (4个季度)
                    const seasonalEnergy = [
                        monthlyEnergy[0] + monthlyEnergy[1] + monthlyEnergy[2], // Q1
                        monthlyEnergy[3] + monthlyEnergy[4] + monthlyEnergy[5], // Q2
                        monthlyEnergy[6] + monthlyEnergy[7] + monthlyEnergy[8], // Q3
                        monthlyEnergy[9] + monthlyEnergy[10] + monthlyEnergy[11] // Q4
                    ];

                    // 3. 计算全周期平均负荷曲线
                    const globalHourlyCurve = new Array(24).fill(0).map((_, h) => {
                        let sum = 0;
                        let count = 0;
                        data.forEach(d => {
                            const val = d.hourlyData?.[h];
                            if (val != null) {
                                sum += val;
                                count++;
                            }
                        });
                        return count > 0 ? (sum / count).toFixed(2) : 0;
                    });

                    // 找出最高月和最低月
                    let maxMonthIdx = 0, minMonthIdx = 0;
                    let maxMonthVal = -1, minMonthVal = Infinity;
                    monthlyEnergy.forEach((val, i) => {
                        if (val > 0) {
                            if (val > maxMonthVal) { maxMonthVal = val; maxMonthIdx = i; }
                            if (val < minMonthVal) { minMonthVal = val; minMonthIdx = i; }
                        }
                    });

                    const totalEnergy = monthlyEnergy.reduce((a, b) => a + b, 0);

                    return {
                        hasData: totalEnergy > 0,
                        totalEnergy: totalEnergy.toFixed(2),
                        monthlyData: monthlyEnergy.map((v, i) => `${i+1}月:${v.toFixed(1)}kWh`).filter((v, i) => monthlyEnergy[i] > 0).join(', '),
                        seasonalData: `Q1:${seasonalEnergy[0].toFixed(1)}, Q2:${seasonalEnergy[1].toFixed(1)}, Q3:${seasonalEnergy[2].toFixed(1)}, Q4:${seasonalEnergy[3].toFixed(1)}`,
                        avgHourlyCurve: globalHourlyCurve.join(', '),
                        maxMonth: `${maxMonthIdx + 1}月`,
                        minMonth: `${minMonthIdx + 1}月`,
                        dataSpan: data.length > 1 ? `${data[0].date} 至 ${data[data.length-1].date}` : '单日'
                    };
                } catch (e) {
                    console.error('Failed to extract data for AI:', e);
                }
            }
            return { hasData: false };
        }

        async function performAIAnalysis() {
            const data = getRealDataForAnalysis();
            
            if (!data.hasData) {
                aiAnalysisContent.innerHTML = `
                    <div class="flex flex-col items-center justify-center py-4 text-slate-400">
                        <i class="fa fa-info-circle text-2xl mb-2 opacity-20"></i>
                        <p class="text-xs">当前图表无有效数据，请先导入或筛选数据</p>
                    </div>
                `;
                return;
            }

            aiAnalysisContent.innerHTML = `
                <div class="flex flex-col gap-4">
                    <div class="flex items-center gap-3 text-indigo-600 animate-pulse">
                        <i class="fa fa-spinner fa-spin"></i>
                        <span class="font-bold text-sm">资深工程师正在进行月度趋势与季节性负荷建模分析...</span>
                    </div>
                    <div class="space-y-3 opacity-50">
                        <div class="h-4 bg-slate-100 rounded-full w-3/4"></div>
                        <div class="h-4 bg-slate-100 rounded-full w-full"></div>
                        <div class="h-4 bg-slate-100 rounded-full w-5/6"></div>
                    </div>
                </div>
            `;
            
            runAiAnalysisBtn.disabled = true;
            runAiAnalysisBtn.classList.add('opacity-50', 'cursor-not-allowed');

            try {
                let analysisText = '';
                
                if (aiConfig.apiKey) {
                    analysisText = await callRealAI(data);
                } else {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                    analysisText = generateMockAnalysis(data);
                }
                
                renderAnalysis(analysisText);
            } catch (error) {
                aiAnalysisContent.innerHTML = `
                    <div class="p-4 rounded-xl bg-red-50 border border-red-100 text-red-600 text-xs">
                        <div class="font-bold mb-1 flex items-center gap-2">
                            <i class="fa fa-exclamation-triangle"></i>
                            <span>分析失败</span>
                        </div>
                        <p>${error.message || '请检查网络连接或 API 配置'}</p>
                        <button onclick="openAiSettings.click()" class="mt-2 text-indigo-600 font-bold hover:underline">去检查配置</button>
                    </div>
                `;
            } finally {
                runAiAnalysisBtn.disabled = false;
                runAiAnalysisBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                aiAnalysisContent.scrollTop = 0;
            }
        }

        async function callRealAI(data) {
            const prompt = `你是一位资深电力系统工程师。请基于以下汇总后的月度、季度用电数据及平均负荷曲线进行深度分析：
数据跨度：${data.dataSpan}
月度用电量：${data.monthlyData}
季度用电量：${data.seasonalData}
全周期平均小时负荷(0-23点)：${data.avgHourlyCurve}
总累计用电：${data.totalEnergy} kWh

分析要求：
1. **季节性/月度趋势：** 分析用电量在不同月份、季节间的波动规律（如夏季高峰、冬季低谷等）。
2. **负荷特性诊断：** 基于平均小时曲线判断该用电主体的基本属性（工业、办公等）及典型日分布。
3. **长期优化建议：** 针对年度/月度分布特征，给出具体的电力成本管控（如容需量申报建议）、设备维保排程或储能投资建议。
4. **字数限制：** 350-500 字，语气专业、直接。

请使用 Markdown 格式。`;

            const baseUrl = aiConfig.apiBase || 'https://api.openai.com/v1';
            const response = await fetch(`${baseUrl}/chat/completions`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${aiConfig.apiKey}`
                },
                body: JSON.stringify({
                    model: aiConfig.model || 'gpt-3.5-turbo',
                    messages: [
                        { role: 'system', content: '你是一位资深电力工程专家，擅长从长周期（月/年）数据中发现用电模式并提供战略级优化建议。' },
                        { role: 'user', content: prompt }
                    ],
                    temperature: 0.7
                })
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => ({}));
                throw new Error(errorData.error?.message || `HTTP error! status: ${response.status}`);
            }

            const result = await response.json();
            return result.choices[0].message.content;
        }

        function generateMockAnalysis(data) {
            return `资深工程师长周期用电分析报告：

1. **季节性趋势分析：**
根据 **${data.dataSpan}** 的汇总数据显示，系统呈现出明显的季节性波动。最高负荷月出现在 **${data.maxMonth}**，对比最低负荷月 **${data.minMonth}**，月度波动率约为 **35%**。这通常与季节性空调负荷或生产淡旺季直接相关。

2. **负荷特性诊断：**
基于全周期平均小时曲线分析，该站点的典型用电模式为“**日间高位平稳型**”。09:00 - 18:00 期间负荷保持在平均水平以上，夜间 23:00 后负荷下降至基准值的 30%。这种分布具有良好的规律性，属于典型的**工业生产或大型办公**建筑。

3. **战略优化建议：**
- **容需量优化：** 鉴于季度间用电差异显著，建议在 **${data.maxMonth}** 之前根据实际需量调整基本电费申报方式，预计可降低基本电费支出约 8%。
- **光伏/储能匹配：** 平均小时曲线显示日间消纳能力极强，建议配置 **${(parseFloat(data.totalEnergy)/365/2).toFixed(0)}kWp** 规模的光伏系统。
- **维保建议：** 建议将主要电气设备的深度维保安排在 **${data.minMonth}** 低谷期，以减少对正常运行的影响。

> *注：当前为基于汇总统计数据生成的模拟报告。如需精准分析请配置 API。*`;
        }

        function renderAnalysis(text) {
            // 简单的 Markdown 转 HTML 渲染
            let html = text
                .replace(/\n\n/g, '</div><div class="mb-4">') // 段落间距
                .replace(/\n/g, '<br>')
                .replace(/\*\*(.*?)\*\*/g, '<strong class="text-slate-900 font-bold">$1</strong>')
                .replace(/^\d\. (.*)$/gm, '<div class="flex gap-3 mb-3"><span class="flex-none h-5 w-5 rounded-full bg-indigo-50 text-indigo-600 flex items-center justify-center text-[10px] font-bold mt-0.5">$0</span><div class="flex-1">$1</div></div>')
                .replace(/^> (.*)$/gm, '<div class="mt-6 p-4 rounded-2xl bg-slate-50 border border-slate-100 italic text-slate-500 text-xs flex gap-3"><i class="fa fa-info-circle text-slate-300 mt-0.5"></i><span>$1</span></div>');
            
            // 修复编号显示：上面的正则会把整个 "1. 内容" 匹配，我们需要提取内容
            html = html.replace(/<span class="flex-none h-5 w-5 rounded-full bg-indigo-50 text-indigo-600 flex items-center justify-center text-\[10px\] font-bold mt-0\.5">(\d)\. (.*)<\/span>/g, 
                                '<span class="flex-none h-5 w-5 rounded-full bg-indigo-50 text-indigo-600 flex items-center justify-center text-[10px] font-bold mt-0.5">$1</span>');

            aiAnalysisContent.innerHTML = `
                <div class="animate-in fade-in slide-in-from-bottom-2 duration-700">
                    <div class="mb-4">${html}</div>
                </div>
            `;
        }

        if (runAiAnalysisBtn) {
            runAiAnalysisBtn.addEventListener('click', performAIAnalysis);
        }
        
        // PDF预览功能
        const pdfPreviewModal = document.getElementById('pdfPreviewModal');
        const pdfPreviewContent = document.getElementById('pdfPreviewContent');
        const pdfPreviewClose = document.getElementById('pdfPreviewClose');
        const pdfPreviewOverlay = document.getElementById('pdfPreviewOverlay');
        const pdfPreviewPrint = document.getElementById('pdfPreviewPrint');
        
        // 关闭PDF预览
        function closePdfPreview() {
            pdfPreviewModal.classList.add('hidden');
            document.body.style.overflow = '';
        }
        
        if (pdfPreviewClose) {
            pdfPreviewClose.addEventListener('click', closePdfPreview);
        }
        
        if (pdfPreviewOverlay) {
            pdfPreviewOverlay.addEventListener('click', closePdfPreview);
        }
        
        // 打印PDF
        if (pdfPreviewPrint) {
            pdfPreviewPrint.addEventListener('click', () => {
                const printWindow = window.open('', '_blank');
                if (printWindow) {
                    const content = pdfPreviewContent.innerHTML;
                    const printStyles = `
                        <style>
                            @page { size: A4; margin: 20mm; }
                            body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica Neue, Arial; }
                            img { max-width: 100%; height: auto; page-break-inside: avoid; }
                            .card { page-break-inside: avoid; }
                            .section { page-break-before: auto; }
                        </style>
                    `;
                    printWindow.document.write(`
                        <!DOCTYPE html>
                        <html>
                        <head>
                            <meta charset="utf-8">
                            <title>负荷数据分析报告</title>
                            ${printStyles}
                        </head>
                        <body>
                            ${content}
                        </body>
                        </html>
                    `);
                    printWindow.document.close();
                    
                    // 等待内容加载完成后打印
                    printWindow.onload = function() {
                        printWindow.print();
                    };
                    
                    // 如果onload不触发，使用setTimeout作为备用
                    setTimeout(() => {
                        if (!printWindow.closed) {
                            printWindow.print();
                        }
                    }, 500);
                }
            });
        }
        
        // 显示PDF预览
        window.showPdfPreview = function(content) {
            pdfPreviewContent.innerHTML = content;
            pdfPreviewModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        };
    </script>
</body></html>

